<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.557">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nigel Gebodh">
<meta name="dcterms.date" content="2025-04-11">

<title>Nigel Gebodh - Building LLM Clinical Data Analytics Pipelines with AWS Bedrock</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../favicon_1.svg" rel="icon" type="image/svg+xml">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-E4M44W57FR"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-E4M44W57FR', { 'anonymize_ip': true});
</script>
<meta name="citation_title" content="Building LLM Clinical Data Analytics Pipelines with AWS Bedrock">
<meta name="citation_author" content="Nigel Gebodh">
<meta name="citation_author_last_name" content="Gebodh">
<meta name="citation_publication_date" content="2025/04/11">
<meta name="citation_publication_year" content="2025">
<meta name="citation_journal_title" content="Projects">
<meta name="citation_url" content="https://ngebodh.github.io/projects/Short_dive_posts/aws/aws-analysis.html">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../styles.css">
<meta property="og:title" content="LLM Powered Analytics Pipeline with AWS Bedrock">
<meta property="og:description" content="Using AWS Bedrock models for clinical data analysis">
<meta property="og:image" content="cover_image.png">
<meta property="og:site_name" content="Nigel **Gebodh**">
<meta name="twitter:title" content="LLM Powered Analytics Pipeline with AWS Bedrock">
<meta name="twitter:description" content="Using AWS Bedrock models for clinical data analysis">
<meta name="twitter:image" content="cover_image.png">
<meta name="twitter:creator" content="@nigelgebodh">
<meta name="twitter:card" content="summary_large_image">
</head>

<body style="margin: 0; padding: 10px; background-color: white;" class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Nigel <strong>Gebodh</strong></span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../publications/publications.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../media/media.html"> 
<span class="menu-text">Talks &amp; Media</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../projects/index.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-connect" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Connect</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-connect">    
        <li>
    <a class="dropdown-item" href="https://scholar.google.com/citations?user=ys2YCxIAAAAJ&amp;hl" target="_blank"><i class="bi bi-mortarboard-fill" role="img">
</i> 
 <span class="dropdown-text">Google Scholar</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://www.linkedin.com/in/nigel-gebodh-1b670a61" target="_blank"><i class="bi bi-bi bi-linkedin" role="img">
</i> 
 <span class="dropdown-text">LinkedIn</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://twitter.com/nigelgebodh" target="_blank"><i class="bi bi-bi bi-twitter-x" role="img">
</i> 
 <span class="dropdown-text">Twitter(X)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/ngebodh" target="_blank"><i class="bi bi-github" role="img">
</i> 
 <span class="dropdown-text">GitHub</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://www.youtube.com/channel/UCXyZEefDuZFzZDdV40sXkpA" target="_blank"><i class="bi bi-bi bi-youtube" role="img">
</i> 
 <span class="dropdown-text">YouTube</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://bsky.app/profile/nigelgebodh.bsky.social" target="_blank"><i class="bi bi-bi bi-butterfly" role="img">
</i> 
 <span class="dropdown-text">BlueSky</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="mailto:nigel.gebodh@gmail.com" target="_blank"><i class="bi bi-envelope" role="img">
</i> 
 <span class="dropdown-text">nigel.gebodh@gmail.com</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="6">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#what-exactly-is-prompt-engineering" id="toc-what-exactly-is-prompt-engineering" class="nav-link active" data-scroll-target="#what-exactly-is-prompt-engineering">What exactly is Prompt Engineering?</a>
  <ul class="collapse">
  <li><a href="#anatomy-of-prompts" id="toc-anatomy-of-prompts" class="nav-link" data-scroll-target="#anatomy-of-prompts">Anatomy of Prompts</a></li>
  </ul></li>
  <li><a href="#the-math" id="toc-the-math" class="nav-link" data-scroll-target="#the-math">The Math</a>
  <ul class="collapse">
  <li><a href="#prompting" id="toc-prompting" class="nav-link" data-scroll-target="#prompting">Prompting</a></li>
  <li><a href="#prompt-templating" id="toc-prompt-templating" class="nav-link" data-scroll-target="#prompt-templating">Prompt Templating</a></li>
  <li><a href="#few-shot-prompting" id="toc-few-shot-prompting" class="nav-link" data-scroll-target="#few-shot-prompting">Few-Shot Prompting</a></li>
  </ul></li>
  <li><a href="#what-exactly-is-aws-bedrock" id="toc-what-exactly-is-aws-bedrock" class="nav-link" data-scroll-target="#what-exactly-is-aws-bedrock">What exactly is AWS Bedrock?</a>
  <ul class="collapse">
  <li><a href="#aws---getting-started" id="toc-aws---getting-started" class="nav-link" data-scroll-target="#aws---getting-started">AWS - Getting Started</a></li>
  <li><a href="#aws---setting-up-bedrock" id="toc-aws---setting-up-bedrock" class="nav-link" data-scroll-target="#aws---setting-up-bedrock">AWS - Setting up Bedrock</a></li>
  <li><a href="#aws---llm-api-templates" id="toc-aws---llm-api-templates" class="nav-link" data-scroll-target="#aws---llm-api-templates">AWS - LLM API Templates</a></li>
  <li><a href="#aws---example" id="toc-aws---example" class="nav-link" data-scroll-target="#aws---example">AWS - Example</a></li>
  </ul></li>
  <li><a href="#what-exactly-is-clinical-data" id="toc-what-exactly-is-clinical-data" class="nav-link" data-scroll-target="#what-exactly-is-clinical-data">What exactly is Clinical Data?</a>
  <ul class="collapse">
  <li><a href="#clinical-narrative-summarization" id="toc-clinical-narrative-summarization" class="nav-link" data-scroll-target="#clinical-narrative-summarization">Clinical Narrative Summarization</a>
  <ul class="collapse">
  <li><a href="#what-do-we-expect" id="toc-what-do-we-expect" class="nav-link" data-scroll-target="#what-do-we-expect">What do we expect?</a></li>
  <li><a href="#model-output" id="toc-model-output" class="nav-link" data-scroll-target="#model-output">Model Output</a></li>
  <li><a href="#what-do-we-see" id="toc-what-do-we-see" class="nav-link" data-scroll-target="#what-do-we-see">What do we see?</a></li>
  </ul></li>
  <li><a href="#diagnosis-generation" id="toc-diagnosis-generation" class="nav-link" data-scroll-target="#diagnosis-generation">Diagnosis Generation</a>
  <ul class="collapse">
  <li><a href="#what-do-we-expect-1" id="toc-what-do-we-expect-1" class="nav-link" data-scroll-target="#what-do-we-expect-1">What do we expect?</a></li>
  <li><a href="#model-output-1" id="toc-model-output-1" class="nav-link" data-scroll-target="#model-output-1">Model Output</a></li>
  <li><a href="#what-do-we-see-1" id="toc-what-do-we-see-1" class="nav-link" data-scroll-target="#what-do-we-see-1">What do we see?</a></li>
  </ul></li>
  <li><a href="#clinical-classification" id="toc-clinical-classification" class="nav-link" data-scroll-target="#clinical-classification">Clinical Classification</a>
  <ul class="collapse">
  <li><a href="#what-do-we-expect-2" id="toc-what-do-we-expect-2" class="nav-link" data-scroll-target="#what-do-we-expect-2">What do we expect?</a></li>
  <li><a href="#model-output-2" id="toc-model-output-2" class="nav-link" data-scroll-target="#model-output-2">Model Output</a></li>
  <li><a href="#example-1" id="toc-example-1" class="nav-link" data-scroll-target="#example-1">● Example 1</a></li>
  <li><a href="#example-2" id="toc-example-2" class="nav-link" data-scroll-target="#example-2">● Example 2</a></li>
  <li><a href="#example-3" id="toc-example-3" class="nav-link" data-scroll-target="#example-3">● Example 3</a></li>
  <li><a href="#what-do-we-see-2" id="toc-what-do-we-see-2" class="nav-link" data-scroll-target="#what-do-we-see-2">What do we see?</a></li>
  </ul></li>
  <li><a href="#structured-data-extraction" id="toc-structured-data-extraction" class="nav-link" data-scroll-target="#structured-data-extraction">Structured Data Extraction</a>
  <ul class="collapse">
  <li><a href="#what-do-we-expect-3" id="toc-what-do-we-expect-3" class="nav-link" data-scroll-target="#what-do-we-expect-3">What do we expect?</a></li>
  <li><a href="#model-output-3" id="toc-model-output-3" class="nav-link" data-scroll-target="#model-output-3">Model Output</a></li>
  <li><a href="#what-do-we-see-3" id="toc-what-do-we-see-3" class="nav-link" data-scroll-target="#what-do-we-see-3">What do we see?</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#putting-it-all-together" id="toc-putting-it-all-together" class="nav-link" data-scroll-target="#putting-it-all-together">Putting it all together</a></li>
  <li><a href="#take-away" id="toc-take-away" class="nav-link" data-scroll-target="#take-away">Take Away</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Building LLM Clinical Data Analytics Pipelines with AWS Bedrock</h1>
<p class="subtitle lead">Leveraging LLMs like Claude and Gemma for clinical data analysis</p>
  <div class="quarto-categories">
    <div class="quarto-category">LLM</div>
    <div class="quarto-category">NLP</div>
    <div class="quarto-category">AWS</div>
    <div class="quarto-category">Bedrock</div>
    <div class="quarto-category">Claude</div>
    <div class="quarto-category">Gemma</div>
    <div class="quarto-category">Llama</div>
    <div class="quarto-category">Math</div>
  </div>
  </div>



<div class="quarto-title-meta column-page-left">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Nigel Gebodh </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 11, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<style> 
      /* The . with the boxed represents that it is a class */
      .boxed {
        background: #e6fffe; /* C5F7F8 E5FAFA E1FCFC  #ecfffe #E5FAFA*/
        color: #0b3357; /* gray navy*/
        border: 3px solid #2980B9;
        margin: 10% auto;
        width: 95%;
        height: 95%;
        padding: 20px;
        border-radius: 20px;
      }
    </style>
<br>
<figure style="text-align: center;" class="figure">
<img src="cover_image.png" alt="Cover_image" width="100%" height="auto" style="display: block; margin-left: auto; margin-right: auto; border: none;" class="figure-img">
<figcaption style="margin-top: 5px; font-style: italic; color: #555;">
Image by FLUX.1 and Nigel Gebodh.
</figcaption>
</figure>
<p><br></p>
<p><strong>Large Language Models (LLMs)</strong> have transformed the way un/structured data analytics is performed.</p>
<p>Here we leverage <strong>prompt engineering</strong> techniques and LLMs on <strong>Amazon Web Services (AWS) Bedrock</strong> (and Hugging Face) to build an analytics pipeline specific to healthcare applications with <strong>clinical data</strong>.</p>
<blockquote class="blockquote">
<p>You can jump straight to the application and experiment with different clinical analytics scenarios/tasks <a href="https://ngebodh.github.io/projects/Short_dive_posts/aws-demo/aws-analysis-demo.html">here</a>.</p>
</blockquote>
<figure class="figure">
<img src="LLM-med_2.gif" alt="LLM word generation" width="85%" height="auto" style="display: block; margin-left: auto; margin-right: auto; border: none;" class="figure-img">
<figcaption style="text-align: center;">
LLM clinical data analysis app using Anthropic’s Claude-3 Haiku.
</figcaption>
</figure>
<section id="what-exactly-is-prompt-engineering" class="level1">
<h1>What exactly is Prompt Engineering?</h1>
<details open="">
<summary>
Prompt Engineering
</summary>
<div class="boxed">
<p><strong>Prompt Engineering</strong>:</p>
<ul>
<li>Is the process of <strong>creating a prompt or input </strong>(i.e.&nbsp;text, audio, image, etc.) to a Generative AI model or LLM in order to retrieve or guide an output.</li>
<li>It generally involves <strong>crafting systematic instructions</strong> that guide an LLM to effectively perform a task.</li>
</ul>
</div>
<section id="anatomy-of-prompts" class="level2">
<h2 class="anchored" data-anchor-id="anatomy-of-prompts">Anatomy of Prompts</h2>
<p>There are several key aspects to effectively creating a prompt to feed to an LLM. We’ll leverage combinations of these prompt components in our data analysis pipeline.</p>
<p>To get a more in-depth understanding of the state of the art in prompting, check out these papers <span class="citation" data-cites="brown2020languagemodelsfewshotlearners schulhoff2025promptreportsystematicsurvey qiao2023reasoninglanguagemodelprompting">(<a href="#ref-brown2020languagemodelsfewshotlearners" role="doc-biblioref">Brown et al., 2020</a>; <a href="#ref-qiao2023reasoninglanguagemodelprompting" role="doc-biblioref">Qiao et al., 2023</a>; <a href="#ref-schulhoff2025promptreportsystematicsurvey" role="doc-biblioref">Schulhoff et al., 2025</a>)</span>.</p>
<p>These are some of the basic prompt aspects (You can test them with different LLMs <a href="https://ngebodh.github.io/projects/2024-03-05/index_demo.html">here</a>):</p>
<details>
<summary>
<strong>Directive</strong>
</summary>
<p>The user’s intent for the LLM. These can be explicitly stated as an instruction or implied with the text format or examples provided (one example → referred to as one-shot)</p>
<p><strong>Example:</strong> We want a direct set of information returned</p>
<ul>
<li><p><strong>Explicit:</strong> Instruction given on what output to produce</p>
<ul>
<li><p><strong>INPUT:</strong><br> <code>Generate a list of the five longest rivers in the world.</code> <br></p></li>
<li><p><strong>OUTPUT:</strong><br> <code>Nile River, Amazon River, Yangtze River, Mississippi River, Yenisei River</code></p></li>
</ul></li>
<li><p><strong>Implicit:</strong> Task implied with structure of the text</p>
<ul>
<li><p><strong>INPUT:</strong><br> <code>New York City: United States</code><br> <code>Paris:</code></p></li>
<li><p><strong>OUTPUT:</strong><br> <code>France</code></p></li>
</ul></li>
</ul>
</details>
<details>
<summary>
<strong>Output Formatting</strong>
</summary>
<p>If a structured output is needed (<code>JSON</code>, <code>CSV</code>, <code>XML</code> etc.) from the LLM, specifying and defining the desired output guides the model to return the desired format. This is also helpful for evaluating a model’s performance if you have a structured ground truth reference/expected output to compare to the models output.</p>
<p><strong>Example:</strong> We want <code>JSON</code> structured (basically a nested dictionary) information returned. We can give an example or have the LLM extract and classify the information to <code>JSON</code> tags (dict keys).</p>
<ul>
<li><p><strong>INPUT:</strong><br> <code>Return the following text in `JSON` format: My name is Sam Mitra. I’m currently 28 and I live in Redmond, WA. I have 2 dogs and 1 cat.</code></p></li>
<li><p><strong>OUTPUT:</strong><br></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="dt">"name"</span><span class="fu">:</span> <span class="st">"Sam Mitra"</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="dt">"age"</span><span class="fu">:</span> <span class="dv">28</span><span class="fu">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="dt">"location"</span><span class="fu">:</span> <span class="st">"Redmond, WA"</span><span class="fu">,</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="dt">"pets"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="dt">"type"</span><span class="fu">:</span> <span class="st">"dog"</span><span class="fu">,</span> <span class="dt">"count"</span><span class="fu">:</span> <span class="dv">2</span><span class="fu">}</span><span class="ot">,</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="dt">"type"</span><span class="fu">:</span> <span class="st">"cat"</span><span class="fu">,</span> <span class="dt">"count"</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">}</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        <span class="ot">]</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</details>
<details>
<summary>
<strong>Style Instructions</strong>
</summary>
<p>These are instructions that control the LLM’s output style by including descriptive adjectives like “clear”, “concise”, “casual”, or “professional” in our prompts, which directly affect the vocabulary used.</p>
<p><strong>Example:</strong> We want a clear, concise definition of what a dog is</p>
<ul>
<li><p><strong>INPUT:</strong> <br> <code>Give a clear and concise definition of what a dog is</code></p></li>
<li><p><strong>OUTPUT:</strong><br> <code>A dog is a domesticated carnivorous mammal (Canis lupus familiaris) that belongs to the family Canidae.</code></p></li>
</ul>
<p><strong>Example:</strong><br>
We want a casual, friendly definition of what a dog is</p>
<ul>
<li><p><strong>INPUT:</strong><br> <code>Give a casual and friendly definition of what a dog is</code></p></li>
<li><p><strong>OUTPUT:</strong><br> <code>Dogs are basically the best! They're furry, four-legged friends that are all about giving you love, snuggles, and slobbery kisses.</code></p></li>
</ul>
</details>
<details>
<summary>
<strong>Role</strong>
</summary>
<p>This is a persona or perspective that you define the LLM to have in producing outputs. This can influence the output style and content returned.</p>
<p><strong>Example:</strong> Define the LLM’s role as a “biomedical engineer and medical doctor”</p>
<ul>
<li><p><strong>INPUT:</strong><br> <code>As a biomedical engineer and medical doctor, give a short, concise explanation of what sea sickness is.</code></p></li>
<li><p><strong>OUTPUT:</strong><br> <code>Sea sickness, also known as motion sickness, is a complex phenomenon resulting from the mismatch between the vestibular system's perception of motion and the visual and proprioceptive systems' input.</code></p></li>
</ul>
<p><strong>Example:</strong> Define the LLM’s role as a “dog”</p>
<ul>
<li><p><strong>INPUT:</strong><br> <code>As a dog, give a short, concise explanation of what sea sickness is.</code></p></li>
<li><p><strong>OUTPUT:</strong><br> <code>WOOF WOOF! whine Oh no, oh no! Sea sickness is when my hooman gets all wobbly and queasy on the boat!</code></p></li>
</ul>
</details>
</section></details>
</section>

<section id="the-math" class="level1">
<h1>The Math</h1>
<p>Effective prompt engineering relies on the fact that modern LLMs are trained on vast datasets, enabling them to understand and follow instructions.</p>
<p>Generally, we can think of <strong>LLMs as autoregressive functions</strong> that when given a sequence of tokens (e.g.&nbsp;words), produce a <strong>probability distribution</strong> for a set of next tokens. These word probabilities are then fed through a <strong>Softmax function</strong> which helps to normalize the probability distribution and select the token with the highest probability (greedy decoding). See <span class="citation" data-cites="gebodh2024LLMtemperature">(<a href="#ref-gebodh2024LLMtemperature" role="doc-biblioref">Gebodh, 2024b</a>)</span> for a dive into Softmax calcualtions and LLM temperature variations.</p>
<figure class="figure">
<img src="LLM_Recap.gif" alt="LLM word generation" width="65%" height="auto" style="display: block; margin-left: auto; margin-right: auto; border: none;" class="figure-img">
<figcaption style="text-align: center;">
A visual recap of LLM word generation.
</figcaption>
</figure>
<p>We can parameterize this process as:</p>
<p><span class="math display">\[
P( \mathbf{Y} | \mathbf{X}) = \prod_{t=1}^{|\mathbf{Y} |} p_{\text{LM}}(y_t |  y_{1:t-1}, \mathbf{X})
\]</span></p>
<p>This basically reads as:</p>
<ul>
<li>What is the conditional probability of <span class="math inline">\(\mathbf{Y}\)</span> given input <span class="math inline">\(\mathbf{X}\)</span>, where <span class="math inline">\(\mathbf{X}\)</span> are tokens that can be text, images, video, audio etc.</li>
<li>We calculate the probability of the output (<span class="math inline">\(\mathbf{Y}\)</span>) by multiplying (<span class="math inline">\(\prod\)</span>) the probabilities of each of the tokens (<span class="math inline">\(t\)</span>), using previous output tokens (<span class="math inline">\(y_{1:t-1}\)</span>) and the input (<span class="math inline">\(\mathbf{X}\)</span>).</li>
</ul>
<section id="prompting" class="level2">
<h2 class="anchored" data-anchor-id="prompting">Prompting</h2>
<details open="">
<summary>
Prompting
</summary>
<p>For prompt engineering we can think of the input (<span class="math inline">\(\mathbf{X}\)</span>) as having two parts:</p>
<ul>
<li><span class="math inline">\(\mathcal{T}\)</span> - the prompt, meaning the general instruction or task you want the LLM to do
<ul>
<li>Example <span class="math inline">\(\mathcal{T}\)</span>: <code>Translate from English to French:</code></li>
</ul></li>
<li><span class="math inline">\(\mathcal{Q}\)</span> - the specific example or question that you’re passing to the LLM
<ul>
<li>Example <span class="math inline">\(\mathcal{Q}\)</span>: <code>The cat and the dog sleep</code></li>
</ul></li>
</ul>
<p>The full input with returned output would be:</p>
<ul>
<li><strong>Input:</strong> <span class="math inline">\(\mathcal{T}\)</span>, <span class="math inline">\(\mathcal{Q}\)</span>: <code>Translate from English to French: The cat and the dog sleep</code></li>
<li><strong>Output:</strong> <span class="math inline">\(\mathbf{Y}\)</span> or <span class="math inline">\(\mathbf{A}\)</span>: <code>Le chat et le chien dorment</code></li>
</ul>
<p>We can rewrite our general LLM parameterization as:</p>
<p><span class="math display">\[\begin{align*}

P( \mathbf{Y} | \textcolor{Plum}{\mathbf{X}})
    &amp; = \prod_{t=1}^{|\mathbf{Y} |} p_{\text{LM}}(y_t |  
      y_{1:t-1},
      \textcolor{Plum}{\mathbf{X}}) \\

P( \mathbf{Y} | \textcolor{Plum}{\mathcal{T} }, \textcolor{Plum}{\mathcal{Q}})
    &amp; = \prod_{t=1}^{|\mathbf{Y} |} p_{\text{LM}}(y_t |  
      y_{1:t-1},
      \textcolor{Plum}{\mathcal{T} }, \textcolor{Plum}{\mathcal{Q}}) \\

\end{align*}\]</span></p>
<p>For convention we can change <span class="math inline">\(\mathbf{Y} \to \mathbf{A}\)</span> meaning <em>Complete Answer</em> and <span class="math inline">\(a_t\)</span> is the <span class="math inline">\(t^{th}\)</span> generated token:</p>
<p><span class="math display">\[\begin{align*}
P( \textcolor{SeaGreen}{\mathbf{Y}} | \textcolor{Plum}{\mathcal{T} }, \textcolor{Plum}{\mathcal{Q}})
    &amp; = \prod_{t=1}^{|\mathbf{Y} |} p_{\text{LM}}(y_t |  
      y_{1:t-1},
      \textcolor{Plum}{\mathcal{T} }, \textcolor{Plum}{\mathcal{Q}}) \\

P( \textcolor{SeaGreen}{\mathbf{A}} | \textcolor{Plum}{\mathcal{T} }, \textcolor{Plum}{\mathcal{Q}})
    &amp; = \prod_{t=1}^{|\textcolor{SeaGreen}{\mathbf{A}} |} p_{\text{LM}}(\textcolor{SeaGreen}{a}_{t} |  
      \textcolor{SeaGreen}{a}_{1:t-1},
      \textcolor{Plum}{\mathcal{T} }, \textcolor{Plum}{\mathcal{Q}}) \\

\end{align*}\]</span></p>
<em>Note:</em> The calculations stop when an end-of-sequence token (i.e.&nbsp;<code>&lt;EOS&gt;</code> or <code>&lt;|endoftext|&gt;</code>) is generated.
</details>
</section>
<section id="prompt-templating" class="level2">
<h2 class="anchored" data-anchor-id="prompt-templating">Prompt Templating</h2>
<details open="">
<summary>
Prompt Templating
</summary>
<p>We can generalize the equation even more by thinking of the prompt (<span class="math inline">\(\mathcal{T}\)</span>) as a function or a template that takes in different questions/queries (<span class="math inline">\(\mathcal{Q} \to x^{*}\)</span>). We can represent the prompt template as <span class="math inline">\(\mathcal{T(\cdot)}\)</span> and when a question/query is plugged in we get <span class="math inline">\(\mathcal{T(x^{*})}\)</span>. The equation then becomes:</p>
<p><span class="math display">\[\begin{align*}

P( \textcolor{SeaGreen}{\mathbf{A}} | \textcolor{Plum}{\mathcal{T(x^{*})} } )
    &amp; = \prod_{t=1}^{|\textcolor{SeaGreen}{\mathbf{A}} |} p_{\text{LM}}(\textcolor{SeaGreen}{a}_{t} |  
      \textcolor{SeaGreen}{a}_{1:t-1},
      \textcolor{Plum}{\mathcal{T(x^{*})} }) \\

\end{align*}\]</span></p>
<p>For example:</p>
<ul>
<li><span class="math inline">\(T(\cdot)\)</span> - The template could be: <br> <code>What is the capital of {ENTER COUNTY}?</code></li>
<li><span class="math inline">\(x^{*}\)</span> - The query or question would be: <br> <code>France</code></li>
<li><span class="math inline">\(\mathcal{T(x^{*})}\)</span> - The full input would be:<br> <code>What is the capital of France?</code></li>
<li><span class="math inline">\(\textcolor{SeaGreen}{\mathbf{A}}\)</span> - The returned answer would be:<br> <code>Paris</code><br>
</li>
</ul>
</details>
</section>
<section id="few-shot-prompting" class="level2">
<h2 class="anchored" data-anchor-id="few-shot-prompting">Few-Shot Prompting</h2>
<details open="">
<summary>
Few-Shot Prompting
</summary>
<p>With few-shot prompting we can think of it as just supplying the template <span class="math inline">\(\mathcal{T(\cdot)}\)</span> with another input which are examples to use to do the task. We can represent the set of examples as <span class="math inline">\(\phi\)</span> where:</p>
<p><span class="math display">\[\begin{align*}
\phi = \{ (z_{i}, y_{i} ) \}_{i=1}^{n}
\end{align*}\]</span></p>
<p>In this case:</p>
<ul>
<li><span class="math inline">\(z_i\)</span> is just example <span class="math inline">\(i\)</span> that we’re passing to the LLM with our query</li>
<li><span class="math inline">\(y_i\)</span> is the corresponding answer to the <span class="math inline">\(i^{th}\)</span> example.</li>
</ul>
<p>For example, for the task of getting country capitals, a 5-shot prompt (<span class="math inline">\(n\)</span> is 5 examples, <span class="math inline">\(z_i\)</span> - country and <span class="math inline">\(y_i\)</span> - the country’s capital) would look like the following where <span class="math inline">\(\phi\)</span> is: <span class="math display">\[\begin{align*}
\phi = \{
  (z_1 = Algeria, y_1 = Algiers)_{1}, \\
  (z_2 =France, y_2 = Paris)_{2}, \\
  (z_3 =Spain, y_3 = Madrid)_{3}, \\
  (z_4 =Norway, y_4 = Oslo)_{4}, \\
  (z_5 =Chile, y_5 = Santiago)_{5}, \\
          \}
\end{align*}\]</span></p>
<p>The few-shot prompted equation then looks like:</p>
<p><span class="math display">\[\begin{align*}

P( \textcolor{SeaGreen}{\mathbf{A}} | \textcolor{Plum}{\mathcal{T(\phi, x^{*})} } )
    &amp; = \prod_{t=1}^{|\textcolor{SeaGreen}{\mathbf{A}} |} p_{\text{LM}}(\textcolor{SeaGreen}{a}_{t} |  
      \textcolor{SeaGreen}{a}_{1:t-1},
      \textcolor{Plum}{\mathcal{T(\phi, x^{*})} }) \\

\end{align*}\]</span></p>
<p>For example the full input prompt would then be:</p>
<ul>
<li><span class="math inline">\(\mathcal{T(\cdot)}\)</span>:<br> <code>What is the capital of {ENTER COUNTRY}?</code></li>
<li><span class="math inline">\(\phi\)</span>:<br> <code>(Algeria, Algiers)</code><br> <code>(France, Paris)</code><br> <code>(Spain, Madrid)</code><br> <code>(Norway, Oslo)</code><br> <code>(Chile, Santiago)</code><br></li>
<li><span class="math inline">\(x^{*}\)</span>:<br> <code>Germany</code></li>
<li><span class="math inline">\({\mathcal{T(\phi, x^{*})} }\)</span>:<br> <code>What is the capital of Algeria?</code><br> <code>Algiers</code><br> <code>What is the capital of France?</code><br> <code>Paris</code><br> <code>What is the capital of Spain?</code><br> <code>Madrid</code><br> <code>What is the capital of Norway?</code><br> <code>Oslo</code><br> <code>What is the capital of Chile?</code><br> <code>Santiago</code><br> <code>What is the capital of Germany?</code><br></li>
</ul>
This full prompt (<span class="math inline">\({\mathcal{T(\phi, x^{*})} }\)</span>) would then be passed to the LLM which should return the response (<span class="math inline">\(\textcolor{SeaGreen}{\mathbf{A}}\)</span>) <code>Berlin</code>.
</details>
</section>
</section>
<section id="what-exactly-is-aws-bedrock" class="level1">
<h1>What exactly is AWS Bedrock?</h1>
<details open="">
<summary>
AWS Bedrock
</summary>
<div class="boxed">
<p><strong>AWS Bedrock</strong> (Amazon Web Services):</p>
<ul>
<li>Is an Amazon product that provides a <strong>platform for leveraging Foundation Models (FM)/LLMs</strong>.</li>
<li>It gives <strong>access to a number of LLMs</strong>, all on one platform.</li>
<li>The models can be accessed through a <strong>central API</strong> (Application Programming Interface).</li>
</ul>
<p>Bedrock abstracts away infrastructure complexities like compute and GPU provisioning, enabling easier development and experimentation with various models. Currently the <a href="https://docs.aws.amazon.com/bedrock/latest/userguide/models-supported.html">Bedrock platform hosts</a> models from Anthropic, Meta, Cohere, Mistral, AI21 etc.</p>
</div>
<section id="aws---getting-started" class="level2">
<h2 class="anchored" data-anchor-id="aws---getting-started">AWS - Getting Started</h2>
<details closed="">
<summary>
Getting started
</summary>
<p>To begin using AWS Bedrock:</p>
<ol type="1">
<li><strong>Create an AWS account</strong>.</li>
<li><strong>Create an IAM user and obtain access keys</strong> (AWS Secret Access Key ID and AWS Secret Access Key - see <a href="https://www.youtube.com/watch?v=lntWTStctIE">here</a>).
<ul>
<li>These keys are used for API authentication and should be stored securely as environment secrets or in a <a href="https://blog.gitguardian.com/how-to-handle-secrets-in-python/"><code>.env</code></a> file.</li>
</ul></li>
<li><strong>Request model access in the Bedrock console.</strong>
<ul>
<li>On Bedrock we can go to <code>Model access</code> then request the models we want to work with. This will take a few minutes for access to be granted.</li>
</ul></li>
<li><strong>Install the <code>boto3</code> Python library for API interaction with Bedrock</strong>
<ul>
<li>Bedrock uses the <a href="https://aws.amazon.com/sdk-for-python/"><code>boto3</code></a> Python library to set up information transfer to and from AWS.</li>
</ul></li>
</ol>
</details>
</section>
<section id="aws---setting-up-bedrock" class="level2">
<h2 class="anchored" data-anchor-id="aws---setting-up-bedrock">AWS - Setting up Bedrock</h2>
<details closed="">
<summary>
Setting up Bedrock
</summary>
<p>Once we have all our credentials in order we set up our connection to AWS. To establish a connection to AWS we import the:</p>
<ul>
<li><code>boto3</code> library to set up our runtime connection</li>
<li><code>os</code> library to get our environment secrets (API ID and key)</li>
</ul>
<p>Import libraries:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> boto3</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Set up our AWS Bedrock access:</p>
<div id="cell-13" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure AWS credentials</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>bedrock_runtime <span class="op">=</span> boto3.client(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    service_name<span class="op">=</span><span class="st">'bedrock-runtime'</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    region_name<span class="op">=</span>os.environ[<span class="st">'AWS_DEFAULT_REGION'</span>], <span class="co">#Region where the Bedrock service is running e.g. us-east-1</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    aws_access_key_id<span class="op">=</span>os.environ[<span class="st">'AWS_ACCESS_KEY_ID'</span>], <span class="co">#AWS Access Key ID</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    aws_secret_access_key<span class="op">=</span>os.environ[<span class="st">'AWS_SECRET_ACCESS_KEY'</span>] <span class="co">#AWS Secret Access Key</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>bedrock_runtime</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>&lt;botocore.client.BedrockRuntime at 0x78c610c21750&gt;</code></pre>
</div>
</div>
</details>
</section>
<section id="aws---llm-api-templates" class="level2">
<h2 class="anchored" data-anchor-id="aws---llm-api-templates">AWS - LLM API Templates</h2>
<details closed="">
<summary>
LLM API Templates
</summary>
<p>Bedrock’s API required model-specific request formats (in some cases it still does), varying significantly between models like <code>Llama 3.3 70B Instruct</code> and <code>Claude V2</code>.</p>
<p>Example Request Differences:</p>
<ul>
<li><p><code>Llama 3.3 70B Instruct</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="st">"modelId"</span>: <span class="st">"meta.llama3-3-70b-instruct-v1:0"</span>,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="st">"contentType"</span>: <span class="st">"application/json"</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="st">"accept"</span>: <span class="st">"application/json"</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="st">"body"</span>: <span class="st">"{</span><span class="ch">\"</span><span class="st">prompt</span><span class="ch">\"</span><span class="st">:</span><span class="ch">\"</span><span class="st">this is where you place your input text</span><span class="ch">\"</span><span class="st">,</span><span class="ch">\"</span><span class="st">max_gen_len</span><span class="ch">\"</span><span class="st">:512,</span><span class="ch">\"</span><span class="st">temperature</span><span class="ch">\"</span><span class="st">:0.5,</span><span class="ch">\"</span><span class="st">top_p</span><span class="ch">\"</span><span class="st">:0.9}"</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><code>Anthropic Claude V2</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"modelId"</span>: <span class="st">"anthropic.claude-v2"</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"contentType"</span>: <span class="st">"application/json"</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"accept"</span>: <span class="st">"*/*"</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"body"</span>: <span class="st">"{</span><span class="ch">\"</span><span class="st">prompt</span><span class="ch">\"</span><span class="st">:</span><span class="ch">\"\\</span><span class="st">n</span><span class="ch">\\</span><span class="st">nHuman: Hello world</span><span class="ch">\\</span><span class="st">n</span><span class="ch">\\</span><span class="st">nAssistant:</span><span class="ch">\"</span><span class="st">,</span><span class="ch">\"</span><span class="st">max_tokens_to_sample</span><span class="ch">\"</span><span class="st">:300,</span><span class="ch">\"</span><span class="st">temperature</span><span class="ch">\"</span><span class="st">:0.5,</span><span class="ch">\"</span><span class="st">top_k</span><span class="ch">\"</span><span class="st">:250,</span><span class="ch">\"</span><span class="st">top_p</span><span class="ch">\"</span><span class="st">:1,</span><span class="ch">\"</span><span class="st">stop_sequences</span><span class="ch">\"</span><span class="st">:[</span><span class="ch">\"\\</span><span class="st">n</span><span class="ch">\\</span><span class="st">nHuman:</span><span class="ch">\"</span><span class="st">],</span><span class="ch">\"</span><span class="st">anthropic_version</span><span class="ch">\"</span><span class="st">:</span><span class="ch">\"</span><span class="st">bedrock-2023-05-31</span><span class="ch">\"</span><span class="st">}"</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
<p>To streamline model interaction, Bedrock introduced the <code>Converse API</code>, providing a unified format. Now, you only need to specify:</p>
<ul>
<li><code>modelId</code>: The model identifier.</li>
<li><code>prompt</code>: The input text.</li>
<li><code>model parameters</code>: Settings like <code>max_tokens_to_sample</code> and <code>temperature</code>.</li>
</ul>
</details>
</section>
<section id="aws---example" class="level2">
<h2 class="anchored" data-anchor-id="aws---example">AWS - Example</h2>
<p><strong>Scenario:</strong> We want to ask an LLM about the symptoms of pneumonia using Anthropic’s Claude model on AWS Bedrock.</p>
<ol type="1">
<li><p><strong>Define the User’s Question:</strong> <br> First, we create the user’s question, which we’ll call the <code>user_message</code> or <code>query</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Start a conversation with the user message.</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>user_message<span class="op">=</span> <span class="st">"What are the symptoms of pneumonia?"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong>Specify the Model:</strong> <br> Next, we choose the LLM we want to use. In this case, we’ll use Anthropic’s Claude 3 Haiku.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the model ID, e.g., Claude 3 Haiku.</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>model_id <span class="op">=</span> <span class="st">"anthropic.claude-3-haiku-20240307-v1:0"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong>Prepare the Conversation Format:</strong> <br> The Bedrock API expects the input in a specific “conversation” format, where each message has a role (either “user” or “assistant”) and content.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>conversation <span class="op">=</span> [</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"content"</span>: [{<span class="st">"text"</span>: user_message}],</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong>Define Inference Configuration:</strong> <br> We define the <code>inference_config</code> for the model, which includes parameters like maximum tokens and temperature.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>inference_config <span class="op">=</span> {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"maxTokens"</span>: <span class="dv">512</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"temperature"</span>: <span class="fl">0.5</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"topP"</span>: <span class="fl">0.9</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong>Send the Request and Receive the Response:</strong> <br> We use the <code>bedrock_runtime.converse</code> function to send the conversation and <code>inference_config</code> to the specified <code>model_id</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>bedrock_runtime <span class="op">=</span> boto3.client(service_name<span class="op">=</span><span class="st">"bedrock-runtime"</span>, </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                                region_name<span class="op">=</span><span class="st">"us-east-1"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span>  bedrock_runtime.converse(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    modelId<span class="op">=</span>model_id,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    messages<span class="op">=</span>conversation,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    inferenceConfig<span class="op">=</span>inference_config</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong>Extract the Response Text:</strong> <br> We extract the model’s response text from the <code>JSON</code> response.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>response_text <span class="op">=</span> response[<span class="st">"output"</span>][<span class="st">"message"</span>][<span class="st">"content"</span>][<span class="dv">0</span>][<span class="st">"text"</span>]</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(response_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong>Encapsulate in a Function:</strong> <br> We can create a function <code>invoke_model</code> to encapsulate these steps, making it easier to reuse (see code in ‘Putting it all together’ section). We’ll display the <code>User Query</code> and <code>LLM Response</code> in chat bubbles so it’s easier to follow the exchange of information.</p>
<details closed="">
<summary>
<p><code>invoke_model</code></p>
</summary>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a> <span class="co">#Define a helper function to call the model and get a response</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a> <span class="kw">def</span> invoke_model(model_id, user_message, conversation<span class="op">=</span><span class="va">None</span>, inference_config<span class="op">=</span><span class="va">None</span>, verbose<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>     <span class="co"># # Set the model ID, e.g., Claude 3 Haiku.</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>     <span class="co"># model_id = "anthropic.claude-3-haiku-20240307-v1:0"</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>     <span class="co"># # Start a conversation with the user message.</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>     <span class="co"># user_message = "Describe the python language."</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span> conversation <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>         conversation <span class="op">=</span> [</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>             {</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"content"</span>: [{<span class="st">"text"</span>: user_message}],</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>             }</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>         ]</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Set the inference configuration.</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span> inference_config <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>         inference_config <span class="op">=</span> {</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>             <span class="st">"maxTokens"</span>: <span class="dv">512</span>,</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>             <span class="st">"temperature"</span>: <span class="fl">0.5</span>,</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>             <span class="st">"topP"</span>: <span class="fl">0.9</span>,</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>     <span class="cf">try</span>:</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Send the message to the model, using a basic inference configuration.</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>         response <span class="op">=</span>  client.converse(</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>             modelId<span class="op">=</span>model_id,</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>             messages<span class="op">=</span>conversation,</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>             inferenceConfig<span class="op">=</span>inference_config</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Extract and print the response text.</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>         response_text <span class="op">=</span> response[<span class="st">"output"</span>][<span class="st">"message"</span>][<span class="st">"content"</span>][<span class="dv">0</span>][<span class="st">"text"</span>]</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> verbose:</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>             <span class="bu">print</span>(<span class="ss">f"Request: </span><span class="sc">{</span>user_message<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>             <span class="bu">print</span>(<span class="ss">f"Response: </span><span class="sc">{</span>response_text<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>         <span class="cf">return</span> response_text</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>     <span class="cf">except</span> (<span class="pp">Exception</span>) <span class="im">as</span> e:</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>         <span class="bu">print</span>(<span class="ss">f"ERROR: Can't invoke '</span><span class="sc">{</span>model_id<span class="sc">}</span><span class="ss">'. Reason: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>         exit(<span class="dv">1</span>)</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a> <span class="co"># Start a conversation with the user message.</span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a> user_message <span class="op">=</span> user_query <span class="op">=</span> <span class="st">"What are the symptoms of pneumonia?"</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a> <span class="co">#Pass the message to the model</span></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a> model_id <span class="op">=</span> <span class="st">"anthropic.claude-3-haiku-20240307-v1:0"</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a> response <span class="op">=</span> model_response <span class="op">=</span> invoke_model(model_id, user_message)</span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a> <span class="co">#Display the user query and model response</span></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a> display_chat_bubble(user_query, sender<span class="op">=</span><span class="st">"user"</span>)</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a> display_chat_bubble(model_response, sender<span class="op">=</span><span class="st">"model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details></li>
</ol>
<div id="cell-20" class="cell">
<div class="cell-output cell-output-display">

    
    
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Chat Bubble</title>
    
    
        <div style="display: flex; align-items: flex-end; justify-content: flex-end;">
            <div style="
        background-color: #E2D3F8;
        color: #333;
        border-radius: 15px;
        padding: 5px 20px;
        margin: 5px 10px;
        align-self: flex-end;
        max-width: 70%;
        word-wrap: break-word;
        font-family: Arial, sans-serif;
        font-size: 11pt;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        white-space: pre-wrap;
        text-align: left;
        ">
                <span style="float: right;font-size: 15pt;"><img src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/1f464.svg" style="height: 1.2em; vertical-align: middle;" alt="👤"></span><b><span style="float: right;">User Query </span></b><br>
                <p>What are the symptoms of pneumonia?</p>
            </div>
        </div>
    
    
</div>
<div class="cell-output cell-output-display">

    
    
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Chat Bubble</title>
    
    
        <div style="display: flex; align-items: flex-start; justify-content: flex-start;">
            <div style="
        background-color: #e1f8fe;
        color: #333;
        border-radius: 15px;
        padding: 5px 20px;
        margin: 5px 5px;
        align-self: flex-start;
        max-width: 70%;
        word-wrap: break-word;
        font-family: Arial, sans-serif;
        font-size: 11pt;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        white-space: pre-wrap;
        text-align: left;
        ">
                <span style="float: left;font-size: 15pt;"><img src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/1fa7a.svg" style="height: 1.2em; vertical-align: middle;" alt="🩺"></span><b><span style="float: left;"> LLM Response</span></b><br>
                <p>The main symptoms of pneumonia include:</p>
<ul>
<li>Cough - This is often the first symptom and may produce mucus or phlegm. The cough may be dry at first.</li>
<li>Fever and chills - Pneumonia often causes a high fever, sometimes over 102°F (39°C).</li>
<li>Difficulty breathing - Breathing may be faster and shallower than normal. Patients may feel short of breath, especially with activity.</li>
<li>Chest pain - There is often a sharp or stabbing chest pain, especially when breathing deeply or coughing.</li>
<li>Fatigue - Pneumonia can cause significant tiredness and weakness.</li>
</ul>
<p>Other potential symptoms include:</p>
<ul>
<li>Nausea and vomiting</li>
<li>Diarrhea</li>
<li>Confusion, especially in older adults</li>
</ul>
<p>The specific symptoms can vary depending on the type of pneumonia, the causative agent, and the patient's age and overall health. Symptoms are usually more severe in the elderly, young children, and those with underlying medical conditions.</p>
<p>Seeking medical attention is important, as pneumonia can be a serious and potentially life-threatening condition that requires prompt treatment.</p>
            </div>
        </div>
    
    
</div>
</div>
</section></details>
</section>

<section id="what-exactly-is-clinical-data" class="level1">
<h1>What exactly is Clinical Data?</h1>
<details open="">
<summary>
Clinical Data
</summary>
<div class="boxed">
<p><strong>Clinical</strong> or <strong>medical data</strong> encompasses a collection of health information generated through patients’ interaction with healthcare systems. This can include:</p>
<ul>
<li><strong>Electronic Health Records (EHRs)</strong> containing patient demographics, medical history, diagnoses, medications, treatment plans, laboratory results, and imaging reports</li>
<li>Clinical <strong>trial data</strong> and research findings</li>
<li><strong>Claims</strong> and <strong>billing</strong> information</li>
<li>Data from <strong>wearable</strong> devices and <strong>remote monitoring</strong> systems</li>
</ul>
<p>Clinical data is particularly complex because it combines <strong>structured</strong> data (like tabular diagnostic codes and lab values) with <strong>unstructured</strong> data (such as clinical notes, radiology reports, and patient narratives). This complexity makes it both challenging and valuable for analytical purposes.</p>
</div>
<p>This section demonstrates clinical data analysis using AWS Bedrock. We’ll explore how to extract insights from <strong>un/structured</strong> clinical data using advanced <strong>prompt engineering</strong>.</p>
<p>We’ll cover these clinical analytics use cases:</p>
<ul>
<li><strong>Clinical Narrative Summarization</strong>: Few-shot prompting for concise medical summaries.</li>
<li><strong>Diagnosis Generation</strong>: Chain-of-thought prompting for preliminary diagnoses.</li>
<li><strong>Clinical Classification</strong>: Zero-shot prompting for data classification.</li>
<li><strong>Structured Data Extraction</strong>: XML-based prompting for targeted information retrieval.</li>
</ul>
</details>
<section id="clinical-narrative-summarization" class="level2">
<h2 class="anchored" data-anchor-id="clinical-narrative-summarization">Clinical Narrative Summarization</h2>
<figure class="figure">
<img src="LLM Medical_summary_01.gif" alt="LLM word generation" width="65%" height="auto" style="display: block; margin-left: auto; margin-right: auto; border: none;" class="figure-img">
<figcaption style="text-align: center;">
LLM workflow for clinical narrative summarization.
</figcaption>
</figure>
<p>Our goal is to get the model to summarize a clinical report.</p>
<p>Here we’ll use a few-shot prompt to get the model to understand the task by showing it examples of the task. The task will be to summarize some medical text into:</p>
<ul>
<li><strong>Key Findings</strong></li>
<li><strong>Recommendations</strong></li>
</ul>
<p>We will provide the model with these examples:</p>
<ul>
<li><strong>Example 1:</strong></li>
</ul>
<blockquote class="blockquote">
<p><strong>INPUT:</strong><br> MRI of the right knee demonstrates a complex tear of the posterior horn and body of the medial meniscus. There is moderate joint effusion and mild chondromalacia of the patellofemoral compartment. The anterior and posterior cruciate ligaments are intact.</p>
<p><strong>OUTPUT:</strong><br> <strong>Key Findings:</strong> Complex tear of medial meniscus (posterior horn and body); Moderate joint effusion; Mild patellofemoral chondromalacia<br> <strong>Recommendations:</strong> Orthopedic consultation; Consider arthroscopic evaluation and treatment</p>
</blockquote>
<ul>
<li><strong>Example 2: </strong></li>
</ul>
<blockquote class="blockquote">
<p><strong>INPUT:</strong><br> Chest X-ray shows clear lung fields bilaterally with no evidence of consolidation, effusion, or pneumothorax. The heart size is within normal limits. No acute cardiopulmonary process identified.</p>
<p><strong>OUTPUT:</strong><br> <strong>Key Findings:</strong> Clear lung fields; Normal heart size; No acute cardiopulmonary process<br> <strong>Recommendations:</strong> No further imaging needed at this time</p>
</blockquote>
<ul>
<li><strong>Model tasked to summarize text:</strong></li>
</ul>
<blockquote class="blockquote">
<p><strong>INPUT:</strong><br> Patient presents with a 3-day history of high fever (103°F), chills, productive cough with yellow sputum, and pleuritic chest pain exacerbated by deep breathing. Physical exam reveals decreased breath sounds and crackles in the right lower lung field. ECG shows sinus tachycardia, but is otherwise unremarkable. Chest X-ray demonstrates consolidation in the right lower lobe, and a small right-sided pleural effusion. White blood cell count is elevated.</p>
<p><strong>OUTPUT:</strong><br></p>
</blockquote>
<section id="what-do-we-expect" class="level3">
<h3 class="anchored" data-anchor-id="what-do-we-expect">What do we expect?</h3>
<p>The model should learn from the examples to extract ailment-related information (e.g., elevated WBC, high fever) and provide appropriate treatment recommendations.</p>
<p>For example an output like below would be consistent with what we expect:</p>
<blockquote class="blockquote">
<p><strong>OUTPUT:</strong><br> <strong>Key Findings:</strong> Right lower lobe consolidation; Right-sided pleural effusion; High fever; Decreased breath sounds and crackles; Elevated WBC.<br> <strong>Recommendations:</strong> Initiate broad-spectrum antibiotics for bacterial pneumonia; Consider sputum cultures; Monitor oxygen saturation; Pain management; Follow-up chest X-ray to assess resolution.</p>
</blockquote>
</section>
<section id="model-output" class="level3">
<h3 class="anchored" data-anchor-id="model-output">Model Output</h3>
<div id="cell-28" class="cell" data-execution_count="144">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Few-shot learning example for medical report summarization</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the examples and query</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>example_1 <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="st">INPUT: </span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="st">MRI of the right knee demonstrates a complex tear of the posterior horn and body of the medial meniscus. </span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="st">There is moderate joint effusion and mild chondromalacia of the patellofemoral compartment. </span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="st">The anterior and posterior cruciate ligaments are intact.</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="st">OUTPUT:</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="st">**Key Findings:** Complex tear of medial meniscus (posterior horn and body); Moderate joint effusion; Mild patellofemoral chondromalacia</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="st">**Recommendations:** Orthopedic consultation; Consider arthroscopic evaluation and treatment</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>example_2 <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="st">INPUT:</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="st">Chest X-ray shows clear lung fields bilaterally with no evidence of consolidation, effusion, or pneumothorax. </span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="st">The heart size is within normal limits. </span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="st">No acute cardiopulmonary process identified.</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="st">OUTPUT:</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="st">**Key Findings:** Clear lung fields; Normal heart size; No acute cardiopulmonary process</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="st">**Recommendations:** No further imaging needed at this time</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="st">INPUT:</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="st">Patient presents with a 3-day history of high fever (103°F), chills, productive cough with yellow sputum, and pleuritic chest pain exacerbated by deep breathing. </span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="st">Physical exam reveals decreased breath sounds and crackles in the right lower lung field. </span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="st">ECG shows sinus tachycardia, but is otherwise unremarkable. </span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="st">Chest X-ray demonstrates consolidation in the right lower lobe, and a small right-sided pleural effusion. White blood cell count is elevated.</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the examples and query into a single prompt</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="co"># We'll use f-strings to insert the content from the examples and query into the full prompt.</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>few_shot_prompt <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a><span class="ss">Task: Summarize the following medical report into key findings and recommendations.</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="ss">Follow  the format of the examples strictly. Make the summary concise and actionable.</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a><span class="ss">The key findings should be short and to the point.</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a><span class="ss">The key findings should be less than 5 words.</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a><span class="ss">The recommendations should be clear and specific.</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a><span class="ss">The summary should be in the following format:</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a><span class="ss">**Key Findings:** [colon-separated list of key findings]</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a><span class="ss">**Recommendations:** [colon-separated list of recommendations]</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span>example_1<span class="sc">}</span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span>example_2<span class="sc">}</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a><span class="ss">Now summarize this medical report:</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span>query<span class="sc">}</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(few_shot_prompt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-29" class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Pass the few-shot prompt to the model</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>model_id <span class="op">=</span> <span class="st">"anthropic.claude-3-haiku-20240307-v1:0"</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> invoke_model(model_id, few_shot_prompt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-32" class="cell" data-execution_count="135">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Display the user query and model response</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>display_chat_bubble(user_query, sender<span class="op">=</span><span class="st">"user"</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>display_chat_bubble(model_response, sender<span class="op">=</span><span class="st">"model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

    
    
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Chat Bubble</title>
    
    
        <div style="display: flex; align-items: flex-end; justify-content: flex-end;">
            <div style="
        background-color: #E2D3F8;
        color: #333;
        border-radius: 15px;
        padding: 5px 20px;
        margin: 5px 10px;
        align-self: flex-end;
        max-width: 70%;
        word-wrap: break-word;
        font-family: Arial, sans-serif;
        font-size: 11pt;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        white-space: pre-wrap;
        text-align: left;
        ">
                <span style="float: right;font-size: 15pt;"><img src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/1f464.svg" style="height: 1.2em; vertical-align: middle;" alt="👤"></span><b><span style="float: right;">User Query </span></b><br>
                <p>Task: Summarize the following medical report into key findings and recommendations.
Follow  the format of the examples strictly. Make the summary concise and actionable.
The key findings should be short and to the point.
The key findings should be less than 5 words.
The recommendations should be clear and specific.
The summary should be in the following format:
<strong>Key Findings:</strong> [colon-separated list of key findings]
<strong>Recommendations:</strong> [colon-separated list of recommendations]</p>
<p>INPUT: 
MRI of the right knee demonstrates a complex tear of the posterior horn and body of the medial meniscus. 
There is moderate joint effusion and mild chondromalacia of the patellofemoral compartment. 
The anterior and posterior cruciate ligaments are intact.
OUTPUT:
<strong>Key Findings:</strong> Complex tear of medial meniscus (posterior horn and body); Moderate joint effusion; Mild patellofemoral chondromalacia
<strong>Recommendations:</strong> Orthopedic consultation; Consider arthroscopic evaluation and treatment</p>
<p>INPUT:
Chest X-ray shows clear lung fields bilaterally with no evidence of consolidation, effusion, or pneumothorax. 
The heart size is within normal limits. 
No acute cardiopulmonary process identified.
OUTPUT:
<strong>Key Findings:</strong> Clear lung fields; Normal heart size; No acute cardiopulmonary process
<strong>Recommendations:</strong> No further imaging needed at this time</p>
<p>Now summarize this medical report:</p>
<p>INPUT:
Patient presents with a 3-day history of high fever (103°F), chills, productive cough with yellow sputum, and pleuritic chest pain exacerbated by deep breathing. 
Physical exam reveals decreased breath sounds and crackles in the right lower lung field. 
ECG shows sinus tachycardia, but is otherwise unremarkable. 
Chest X-ray demonstrates consolidation in the right lower lobe, and a small right-sided pleural effusion. White blood cell count is elevated.</p>
            </div>
        </div>
    
    
</div>
<div class="cell-output cell-output-display">

    
    
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Chat Bubble</title>
    
    
        <div style="display: flex; align-items: flex-start; justify-content: flex-start;">
            <div style="
        background-color: #e1f8fe;
        color: #333;
        border-radius: 15px;
        padding: 5px 20px;
        margin: 5px 5px;
        align-self: flex-start;
        max-width: 70%;
        word-wrap: break-word;
        font-family: Arial, sans-serif;
        font-size: 11pt;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        white-space: pre-wrap;
        text-align: left;
        ">
                <span style="float: left;font-size: 15pt;"><img src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/1fa7a.svg" style="height: 1.2em; vertical-align: middle;" alt="🩺"></span><b><span style="float: left;"> LLM Response</span></b><br>
                <p><strong>Key Findings:</strong> High fever; Productive cough; Right lower lobe consolidation; Pleural effusion; Elevated WBC
<strong>Recommendations:</strong> Initiate antibiotic therapy; Consider chest CT scan; Monitor for clinical improvement</p>
            </div>
        </div>
    
    
</div>
</div>
</section>
<section id="what-do-we-see" class="level3">
<h3 class="anchored" data-anchor-id="what-do-we-see">What do we see?</h3>
<p>The model’s output aligned with the prompt, providing contextually accurate <strong>Key Findings</strong> and <strong>Recommendations</strong> for the <strong>pneumonia</strong> scenario, and respecting the defined response parameters.</p>
</section>
</section>
<section id="diagnosis-generation" class="level2">
<h2 class="anchored" data-anchor-id="diagnosis-generation">Diagnosis Generation</h2>
<figure class="figure">
<img src="LLM Medical_diagnosis_02.gif" alt="LLM word generation" width="65%" height="auto" style="display: block; margin-left: auto; margin-right: auto; border: none;" class="figure-img">
<figcaption style="text-align: center;">
LLM workflow for diagnosis generation.
</figcaption>
</figure>
<p>Our goal is to provide a preliminary medical diagnosis of a patient based on their symptoms.</p>
<p>Here we’ll use a chain-of-thought prompting to guide the model through a systematic reasoning process.</p>
<p>We will define the following steps for the model to follow to arrive at the answer:</p>
<ul>
<li><strong>Step 1</strong>: List potential diagnoses that could explain these symptoms.</li>
<li><strong>Step 2</strong>: For each potential diagnosis, evaluate the likelihood based on the symptom presentation.</li>
<li><strong>Step 3</strong>: Identify what additional tests or information would be most valuable for differential diagnosis.</li>
<li><strong>Step 4</strong>: Recommend a preliminary diagnosis and next steps.</li>
</ul>
<p>Data provided to the model:</p>
<blockquote class="blockquote">
<p>Patient’s symptoms:</p>
<ul>
<li>Persistent cough for 3 weeks, after returning from a trip to a humid tropical country</li>
<li>Chest pain while breathing deeply</li>
<li>Low-grade fever (99.5°F)</li>
<li>Fatigue and decreased appetite</li>
</ul>
</blockquote>
<section id="what-do-we-expect-1" class="level3">
<h3 class="anchored" data-anchor-id="what-do-we-expect-1">What do we expect?</h3>
<p>The given symptoms are consistent with pneumonia (although it overlaps with other conditions). We would expect the model to consider pneumonia as a potential diagnosis and provide treatment recommendations consistent with pneumonia or other similar conditions. We’ll look at <strong>Step 2</strong> to verify that pneumonia was considered in coming to a potential diagnosis.</p>
</section>
<section id="model-output-1" class="level3">
<h3 class="anchored" data-anchor-id="model-output-1">Model Output</h3>
<div id="cell-38" class="cell" data-execution_count="147">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chain-of-Thought Prompting example for medical diagnosis</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>symptoms <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="st">- Persistent cough for 3 weeks, after returning from a trip to a humid tropical country.</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="st">- Chest pain while breathing deeply</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="st">- Low-grade fever (99.5°F)</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="st">- Fatigue and decreased appetite</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>cot_prompt <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="ss">You are a medical expert. You are given the following patient's symptoms.</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span>symptoms<span class="sc">}</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="ss">Follow these steps to get to a preliminary diagnosis and recommendations:</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="ss">Step 1: List potential diagnoses that could explain these symptoms.</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="ss">Step 2: For each potential diagnosis, evaluate the likelihood based on the symptom presentation.</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="ss">Step 3: Identify what additional tests or information would be most valuable for differential diagnosis.</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="ss">Step 4: Recommend a preliminary diagnosis and next steps.</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="ss">Your response should be in the following format:   </span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="ss">**Step 1:** [potential diagnoses]</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="ss">**Step 2:** [likelihood for each diagnosis]</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="ss">**Step 3:** [brief list of tests or information]</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="ss">**Step 4:** [preliminary diagnosis]</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="ss">**Diagnosis:** [diagnosis]</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="ss">**Likelihood:** [likelihood]</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="ss">**Next steps:** [next steps]</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cot_prompt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-39" class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Pass the CoT prompt to the model</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>model_id <span class="op">=</span> <span class="st">"anthropic.claude-3-haiku-20240307-v1:0"</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> invoke_model(model_id, cot_prompt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-42" class="cell" data-execution_count="150">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Display the user query and model response</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>display_chat_bubble(user_query, sender<span class="op">=</span><span class="st">"user"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>display_chat_bubble(model_response, sender<span class="op">=</span><span class="st">"model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

    
    
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Chat Bubble</title>
    
    
        <div style="display: flex; align-items: flex-end; justify-content: flex-end;">
            <div style="
        background-color: #E2D3F8;
        color: #333;
        border-radius: 15px;
        padding: 5px 20px;
        margin: 5px 10px;
        align-self: flex-end;
        max-width: 70%;
        word-wrap: break-word;
        font-family: Arial, sans-serif;
        font-size: 11pt;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        white-space: pre-wrap;
        text-align: left;
        ">
                <span style="float: right;font-size: 15pt;"><img src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/1f464.svg" style="height: 1.2em; vertical-align: middle;" alt="👤"></span><b><span style="float: right;">User Query </span></b><br>
                <p>You are a medical expert. You are given the following patient's symptoms.</p>
<ul>
<li>Persistent cough for 3 weeks, after returning from a trip to a humid tropical country.</li>
<li>Chest pain while breathing deeply</li>
<li>Low-grade fever (99.5°F)</li>
<li>Fatigue and decreased appetite</li>
</ul>
<p>Follow these steps to get to a preliminary diagnosis and recommendations:
Step 1: List potential diagnoses that could explain these symptoms.
Step 2: For each potential diagnosis, evaluate the likelihood based on the symptom presentation.
Step 3: Identify what additional tests or information would be most valuable for differential diagnosis.
Step 4: Recommend a preliminary diagnosis and next steps.</p>
<p>Your response should be in the following format: <br>
<strong>Step 1:</strong> [potential diagnoses]
<strong>Step 2:</strong> [likelihood for each diagnosis]
<strong>Step 3:</strong> [brief list of tests or information]
<strong>Step 4:</strong> [preliminary diagnosis]</p>
<p><strong>Diagnosis:</strong> [diagnosis]
<strong>Likelihood:</strong> [likelihood]
<strong>Next steps:</strong> [next steps]</p>
            </div>
        </div>
    
    
</div>
<div class="cell-output cell-output-display">

    
    
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Chat Bubble</title>
    
    
        <div style="display: flex; align-items: flex-start; justify-content: flex-start;">
            <div style="
        background-color: #e1f8fe;
        color: #333;
        border-radius: 15px;
        padding: 5px 20px;
        margin: 5px 5px;
        align-self: flex-start;
        max-width: 70%;
        word-wrap: break-word;
        font-family: Arial, sans-serif;
        font-size: 11pt;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        white-space: pre-wrap;
        text-align: left;
        ">
                <span style="float: left;font-size: 15pt;"><img src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/1fa7a.svg" style="height: 1.2em; vertical-align: middle;" alt="🩺"></span><b><span style="float: left;"> LLM Response</span></b><br>
                <p>As a medical expert, I will follow the steps you provided to arrive at a preliminary diagnosis and recommendations for the given patient's symptoms.</p>
<p><strong>Step 1:</strong> Potential Diagnoses
- Pneumonia
- Tuberculosis
- Fungal lung infection (e.g., histoplasmosis, coccidioidomycosis)
- Lung cancer
- Pulmonary embolism</p>
<p><strong>Step 2:</strong> Likelihood of Potential Diagnoses
- Pneumonia: High likelihood, as the patient has a persistent cough, chest pain, and low-grade fever, which are common symptoms of pneumonia.
- Tuberculosis: Moderate likelihood, as the patient has recently returned from a humid tropical country, which is a risk factor for tuberculosis.
- Fungal lung infection: Moderate likelihood, as the patient has recently returned from a humid tropical country, which is a risk factor for certain fungal infections.
- Lung cancer: Low likelihood, as the patient's symptoms are more indicative of an infectious or inflammatory process.
- Pulmonary embolism: Low likelihood, as the patient does not have any known risk factors for this condition.</p>
<p><strong>Step 3:</strong> Additional Tests or Information
- Chest X-ray or CT scan to evaluate the lungs and identify any abnormalities
- Sputum culture or acid-fast bacilli (AFB) test to check for bacterial or mycobacterial infections
- Blood tests, including complete blood count (CBC) and inflammatory markers (e.g., C-reactive protein, erythrocyte sedimentation rate)
- Travel history and potential exposures during the trip to the humid tropical country</p>
<p><strong>Step 4:</strong> Preliminary Diagnosis and Next Steps
<strong>Preliminary Diagnosis:</strong> Pneumonia
<strong>Likelihood:</strong> High</p>
<p><strong>Next Steps:</strong>
1. Order a chest X-ray or CT scan to assess the lungs and identify any signs of pneumonia or other pulmonary abnormalities.
2. Obtain sputum samples for culture and AFB testing to rule out bacterial or mycobacterial infections, such as tuberculosis.
3. Perform blood tests, including a CBC and inflammatory markers, to support the diagnosis of pneumonia and monitor the patient's response to treatment.
4. Gather more information about the patient's recent travel history and potential exposures during the trip to the humid tropical country</p>
            </div>
        </div>
    
    
</div>
</div>
</section>
<section id="what-do-we-see-1" class="level3">
<h3 class="anchored" data-anchor-id="what-do-we-see-1">What do we see?</h3>
<p>We see that the model was able to <strong>follow the steps</strong> we defined in order to get to a preliminary diagnosis and provide some next steps. Based on the symptoms the model identified that the patient has a <strong>high likelihood of having pneumonia</strong> as we expected.</p>
</section>
</section>
<section id="clinical-classification" class="level2">
<h2 class="anchored" data-anchor-id="clinical-classification">Clinical Classification</h2>
<figure class="figure">
<img src="LLM Medical_classification_02.gif" alt="LLM word generation" width="65%" height="auto" style="display: block; margin-left: auto; margin-right: auto; border: none;" class="figure-img">
<figcaption style="text-align: center;">
LLM workflow for clinical classification.
</figcaption>
</figure>
<p>Our goal is to classify medical data into different categories using zero-shot prompting. Here we’ll pass the model a prompt with the category labels and the data to be classified.</p>
<p>Here’s an example of what we’ll be passing to the model:</p>
<blockquote class="blockquote">
<p><strong>medical_text_1</strong> = “Patient presents with a fever of 103.5 degrees Fahrenheit, accompanied by severe chills, rigors, body aches, and a persistent throbbing headache. The patient reports feeling disoriented, has a flushed face, and exhibits petechiae on the chest and extremities. White blood cell count is elevated. Patient reports recent lower backpain on their left side and some blood in their urine.”</p>
<p><strong>categories_1 </strong>= [“Infection”, “Heat Stroke”, “Drug Reaction”]</p>
</blockquote>
<p>In this case the classification should be <strong>Infection</strong> based on the information provided.</p>
<section id="what-do-we-expect-2" class="level3">
<h3 class="anchored" data-anchor-id="what-do-we-expect-2">What do we expect?</h3>
<p>In each case we would expect that the model would recognize the classic symptoms presented in the clinical information. From there it should be able to link that information to one of the three classes provided, selecting the most likely class.</p>
</section>
<section id="model-output-2" class="level3">
<h3 class="anchored" data-anchor-id="model-output-2">Model Output</h3>
<div id="cell-48" class="cell" data-execution_count="151">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Zero-shot learning example for medical classification</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 1: Fever with More Symptoms</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>medical_text_1 <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="st">Patient presents with a fever of 102.5 degrees Fahrenheit, accompanied by severe chills, body aches,</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="st">and a persistent headache. The patient reports feeling disoriented and has a flushed face.</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>medical_text_1 <span class="op">=</span><span class="st">" "</span>.join(medical_text_1.splitlines())</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>categories_1 <span class="op">=</span> [<span class="st">"Infection"</span>, <span class="st">"Heat Stroke"</span>, <span class="st">"Drug Reaction"</span>]</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 2: Broken Bone with Injury Details</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>medical_text_2 <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="st">Patient sustained a fall from a ladder, with immediate onset of severe pain and swelling in the lower leg. </span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="st">X-ray shows a complete, displaced fracture of the tibia, with evidence of soft tissue injury.</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>medical_text_2 <span class="op">=</span><span class="st">" "</span>.join(medical_text_2.splitlines())</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>categories_2 <span class="op">=</span> [<span class="st">"Fracture"</span>, <span class="st">"Sprain"</span>, <span class="st">"Muscle Strain"</span>]</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Example 3: Fever, Cough, Nasal Congestion Symptoms</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>medical_text_3 <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="st">Patient presents with a sudden onset of high fever (102-104°F), accompanied by severe chills, </span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="st">intense muscle aches (myalgia), and a persistent, dry cough. The patient reports a severe headache, </span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="st">significant fatigue, and a sore throat. Nasal congestion is minimal. </span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="st">The patient reports that many people in their workplace have been experiencing similar symptoms recently.</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>medical_text_3 <span class="op">=</span><span class="st">" "</span>.join(medical_text_3.splitlines())</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>categories_3 <span class="op">=</span> [<span class="st">"Common Cold"</span>, <span class="st">"Flu"</span>, <span class="st">"Allergies"</span>]</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> zero_shot_classification_prompt(text, categories):</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> textwrap</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combine the examples into a single prompt</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>    prompt <span class="op">=</span> (</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"Task: Classify the following medical cases into the correct category.</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"Choose the most appropriate category from the list provided: </span><span class="sc">{</span><span class="st">', '</span><span class="sc">.</span>join(categories)<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"Text: </span><span class="sc">{</span>text<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"Response format:</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"**Category:** [selected category]</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"**Confidence:** [high/medium/low]</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"**Reasoning:** [brief explanation]"</span></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> prompt</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>zero_shot_prompt <span class="op">=</span> zero_shot_classification_prompt(text <span class="op">=</span> medical_text_1, categories <span class="op">=</span> categories_1)</span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(zero_shot_prompt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="example-1" class="level3">
<h3 class="anchored" data-anchor-id="example-1">● Example 1</h3>
<div id="cell-50" class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Pass the zero-shot prompt to the model</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>model_id <span class="op">=</span> <span class="st">"anthropic.claude-3-haiku-20240307-v1:0"</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>zero_shot_prompt <span class="op">=</span> zero_shot_classification_prompt(text <span class="op">=</span> medical_text_1, categories <span class="op">=</span> categories_1)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> invoke_model(model_id, zero_shot_prompt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-53" class="cell" data-execution_count="154">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Display the user query and model response</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>display_chat_bubble(user_query, sender<span class="op">=</span><span class="st">"user"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>display_chat_bubble(model_response, sender<span class="op">=</span><span class="st">"model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

    
    
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Chat Bubble</title>
    
    
        <div style="display: flex; align-items: flex-end; justify-content: flex-end;">
            <div style="
        background-color: #E2D3F8;
        color: #333;
        border-radius: 15px;
        padding: 5px 20px;
        margin: 5px 10px;
        align-self: flex-end;
        max-width: 70%;
        word-wrap: break-word;
        font-family: Arial, sans-serif;
        font-size: 11pt;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        white-space: pre-wrap;
        text-align: left;
        ">
                <span style="float: right;font-size: 15pt;"><img src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/1f464.svg" style="height: 1.2em; vertical-align: middle;" alt="👤"></span><b><span style="float: right;">User Query </span></b><br>
                <p>Task: Classify the following medical cases into the correct category.
Choose the most appropriate category from the list provided: Infection, Heat Stroke, Drug Reaction</p>
<p>Text:  Patient presents with a fever of 102.5 degrees Fahrenheit, accompanied by severe chills, body aches, and a persistent headache. The patient reports feeling disoriented and has a flushed face.</p>
<p>Response format:
<strong>Category:</strong> [selected category]
<strong>Confidence:</strong> [high/medium/low]
<strong>Reasoning:</strong> [brief explanation]</p>
            </div>
        </div>
    
    
</div>
<div class="cell-output cell-output-display">

    
    
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Chat Bubble</title>
    
    
        <div style="display: flex; align-items: flex-start; justify-content: flex-start;">
            <div style="
        background-color: #e1f8fe;
        color: #333;
        border-radius: 15px;
        padding: 5px 20px;
        margin: 5px 5px;
        align-self: flex-start;
        max-width: 70%;
        word-wrap: break-word;
        font-family: Arial, sans-serif;
        font-size: 11pt;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        white-space: pre-wrap;
        text-align: left;
        ">
                <span style="float: left;font-size: 15pt;"><img src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/1fa7a.svg" style="height: 1.2em; vertical-align: middle;" alt="🩺"></span><b><span style="float: left;"> LLM Response</span></b><br>
                <p><strong>Category:</strong> Infection
<strong>Confidence:</strong> High
<strong>Reasoning:</strong> The patient's symptoms, including fever, chills, body aches, and headache, are typical of an infection. The disorientation and flushed face could also be indicative of an underlying infection, rather than heat stroke or a drug reaction.</p>
            </div>
        </div>
    
    
</div>
</div>
</section>
<section id="example-2" class="level3">
<h3 class="anchored" data-anchor-id="example-2">● Example 2</h3>
<div id="cell-56" class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Pass the zero-shot prompt to the model</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>model_id <span class="op">=</span> <span class="st">"anthropic.claude-3-haiku-20240307-v1:0"</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>zero_shot_prompt <span class="op">=</span> zero_shot_classification_prompt(text <span class="op">=</span> medical_text_2, categories <span class="op">=</span> categories_2)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> invoke_model(model_id, zero_shot_prompt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-59" class="cell" data-execution_count="158">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Display the user query and model response</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>display_chat_bubble(user_query, sender<span class="op">=</span><span class="st">"user"</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>display_chat_bubble(model_response, sender<span class="op">=</span><span class="st">"model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

    
    
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Chat Bubble</title>
    
    
        <div style="display: flex; align-items: flex-end; justify-content: flex-end;">
            <div style="
        background-color: #E2D3F8;
        color: #333;
        border-radius: 15px;
        padding: 5px 20px;
        margin: 5px 10px;
        align-self: flex-end;
        max-width: 70%;
        word-wrap: break-word;
        font-family: Arial, sans-serif;
        font-size: 11pt;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        white-space: pre-wrap;
        text-align: left;
        ">
                <span style="float: right;font-size: 15pt;"><img src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/1f464.svg" style="height: 1.2em; vertical-align: middle;" alt="👤"></span><b><span style="float: right;">User Query </span></b><br>
                <p>Task: Classify the following medical cases into the correct category.
Choose the most appropriate category from the list provided: Fracture, Sprain, Muscle Strain</p>
<p>Text:  Patient sustained a fall from a ladder, with immediate onset of severe pain and swelling in the lower leg.  X-ray shows a complete, displaced fracture of the tibia, with evidence of soft tissue injury.</p>
<p>Response format:
<strong>Category:</strong> [selected category]
<strong>Confidence:</strong> [high/medium/low]
<strong>Reasoning:</strong> [brief explanation]</p>
            </div>
        </div>
    
    
</div>
<div class="cell-output cell-output-display">

    
    
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Chat Bubble</title>
    
    
        <div style="display: flex; align-items: flex-start; justify-content: flex-start;">
            <div style="
        background-color: #e1f8fe;
        color: #333;
        border-radius: 15px;
        padding: 5px 20px;
        margin: 5px 5px;
        align-self: flex-start;
        max-width: 70%;
        word-wrap: break-word;
        font-family: Arial, sans-serif;
        font-size: 11pt;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        white-space: pre-wrap;
        text-align: left;
        ">
                <span style="float: left;font-size: 15pt;"><img src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/1fa7a.svg" style="height: 1.2em; vertical-align: middle;" alt="🩺"></span><b><span style="float: left;"> LLM Response</span></b><br>
                <p><strong>Category:</strong> Fracture
<strong>Confidence:</strong> High
<strong>Reasoning:</strong> The given description indicates that the patient sustained a fall from a ladder, resulting in severe pain and swelling in the lower leg. The X-ray findings show a complete, displaced fracture of the tibia, which is a clear indication of a fracture. The presence of soft tissue injury further supports the diagnosis of a fracture.</p>
            </div>
        </div>
    
    
</div>
</div>
</section>
<section id="example-3" class="level3">
<h3 class="anchored" data-anchor-id="example-3">● Example 3</h3>
<div id="cell-62" class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Pass the zero-shot prompt to the model</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>model_id <span class="op">=</span> <span class="st">"anthropic.claude-3-haiku-20240307-v1:0"</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>zero_shot_prompt <span class="op">=</span> zero_shot_classification_prompt(text <span class="op">=</span> medical_text_3, categories <span class="op">=</span> categories_3)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> invoke_model(model_id, zero_shot_prompt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-65" class="cell" data-execution_count="161">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Display the user query and model response</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>display_chat_bubble(user_query, sender<span class="op">=</span><span class="st">"user"</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>display_chat_bubble(model_response, sender<span class="op">=</span><span class="st">"model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

    
    
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Chat Bubble</title>
    
    
        <div style="display: flex; align-items: flex-end; justify-content: flex-end;">
            <div style="
        background-color: #E2D3F8;
        color: #333;
        border-radius: 15px;
        padding: 5px 20px;
        margin: 5px 10px;
        align-self: flex-end;
        max-width: 70%;
        word-wrap: break-word;
        font-family: Arial, sans-serif;
        font-size: 11pt;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        white-space: pre-wrap;
        text-align: left;
        ">
                <span style="float: right;font-size: 15pt;"><img src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/1f464.svg" style="height: 1.2em; vertical-align: middle;" alt="👤"></span><b><span style="float: right;">User Query </span></b><br>
                <p>Task: Classify the following medical cases into the correct category.
Choose the most appropriate category from the list provided: Common Cold, Flu, Allergies</p>
<p>Text:  Patient presents with a sudden onset of high fever (102-104°F), accompanied by severe chills,  intense muscle aches (myalgia), and a persistent, dry cough. The patient reports a severe headache,  significant fatigue, and a sore throat. Nasal congestion is minimal.  The patient reports that many people in their workplace have been experiencing similar symptoms recently.</p>
<p>Response format:
<strong>Category:</strong> [selected category]
<strong>Confidence:</strong> [high/medium/low]
<strong>Reasoning:</strong> [brief explanation]</p>
            </div>
        </div>
    
    
</div>
<div class="cell-output cell-output-display">

    
    
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Chat Bubble</title>
    
    
        <div style="display: flex; align-items: flex-start; justify-content: flex-start;">
            <div style="
        background-color: #e1f8fe;
        color: #333;
        border-radius: 15px;
        padding: 5px 20px;
        margin: 5px 5px;
        align-self: flex-start;
        max-width: 70%;
        word-wrap: break-word;
        font-family: Arial, sans-serif;
        font-size: 11pt;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        white-space: pre-wrap;
        text-align: left;
        ">
                <span style="float: left;font-size: 15pt;"><img src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/1fa7a.svg" style="height: 1.2em; vertical-align: middle;" alt="🩺"></span><b><span style="float: left;"> LLM Response</span></b><br>
                <p><strong>Category:</strong> Flu
<strong>Confidence:</strong> High
<strong>Reasoning:</strong> The patient's symptoms, including high fever, severe chills, intense muscle aches, persistent dry cough, headache, fatigue, and sore throat, are characteristic of the flu (influenza) rather than a common cold or allergies. The sudden onset of these symptoms and the report of similar cases in the patient's workplace further support the diagnosis of the flu.</p>
            </div>
        </div>
    
    
</div>
</div>
</section>
<section id="what-do-we-see-2" class="level3">
<h3 class="anchored" data-anchor-id="what-do-we-see-2">What do we see?</h3>
<p>As anticipated, the model accurately classified symptoms across all cases, demonstrating its ability to recognize clinical indications from diverse domains, including:</p>
<ul>
<li><strong>Infectious disease</strong> (Example 1)</li>
<li><strong>Orthopedic trauma</strong> (Example 2)</li>
<li><strong>Viral illness</strong> (Example 3)</li>
</ul>
</section>
</section>
<section id="structured-data-extraction" class="level2">
<h2 class="anchored" data-anchor-id="structured-data-extraction">Structured Data Extraction</h2>
<figure class="figure">
<img src="LLM Medical_extraction_01.gif" alt="LLM word generation" width="65%" height="auto" style="display: block; margin-left: auto; margin-right: auto; border: none;" class="figure-img">
<figcaption style="text-align: center;">
LLM workflow for structured data extraction.
</figcaption>
</figure>
<p>Our goal is to use the LLM to extract specific information from medical data, guided by XML tags.</p>
<p><strong>XML</strong>’s (Extensible Markup Language) structured format is key here, making it easier for the LLM to understand the data’s organization. We use tags like <code>&lt;instructions&gt;</code> and <code>&lt;example&gt;</code> to provide direct guidance and illustrative examples. We’ll use XML tags along with one-shot learning to show the LLMs how to extract and format clinical data to be returned as an output.</p>
<p>For example we can use XML tags to indicate where each part of the prompt begins and ends. The example below defines 3 main parts:</p>
<ol type="1">
<li>The <code>&lt;instruction&gt;</code> or task that we want the model to perform.</li>
<li>The input data that we want the model to use, in this case a <code>&lt;clinical_note&gt;</code>.</li>
<li>The format that we want returned for the extracted data. Defined as <code>&lt;output_schema&gt;</code>.</li>
</ol>
<blockquote class="blockquote">
<p><code>&lt;instructions&gt;</code><br> Extract the patient’s name, age, and diagnosis from the following clinical note.<br> <code>&lt;/instructions&gt;</code></p>
<p><code>&lt;clinical_note&gt;</code><br> Patient: John Smith, 67 years old, presented with symptoms of acute myocardial infarction.<br> <code>&lt;/clinical_note&gt;</code><br></p>
<p><code>&lt;output_schema&gt;</code><br> <code>&lt;patient_name&gt;</code> <code>&lt;/patient_name&gt;</code><br> <code>&lt;patient_age&gt;</code> <code>&lt;/patient_age&gt;</code><br> <code>&lt;diagnosis&gt;</code> <code>&lt;/diagnosis&gt;</code><br> <code>&lt;/output_schema&gt;</code><br></p>
</blockquote>
<section id="what-do-we-expect-3" class="level3">
<h3 class="anchored" data-anchor-id="what-do-we-expect-3">What do we expect?</h3>
<p>We expect that the model would be able to accurately follow the instructions given, effectively analyze the input data, correctly extract and format the data given the formatting guide.</p>
<p>For example, for the given input above we would expect the model to return:</p>
<blockquote class="blockquote">
<p><code>&lt;output_schema&gt;</code><br> <code>&lt;patient_name&gt;</code> <strong>John Smith</strong> <code>&lt;/patient_name&gt;</code><br> <code>&lt;patient_age&gt;</code> <strong>67</strong> <code>&lt;/patient_age&gt;</code><br> <code>&lt;diagnosis&gt;</code> <strong>Acute Myocardial Infarction</strong> <code>&lt;/diagnosis&gt;</code><br> <code>&lt;/output_schema&gt;</code><br></p>
</blockquote>
</section>
<section id="model-output-3" class="level3">
<h3 class="anchored" data-anchor-id="model-output-3">Model Output</h3>
<div id="cell-71" class="cell" data-execution_count="162">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>clinical_note <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="st">Todays date is March 12th, 2025.</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="st">Patient, Marty K. Martin, is a 62-year-old male with a history of hypertension, type 2 diabetes, and hyperlipidemia. </span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="st">Currently taking Lisinopril 20mg daily, Metformin 1000mg BID, and Atorvastatin 40mg at bedtime. </span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="st">Patient reports having a coronary artery bypass graft (CABG) 5 years ago.</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="st">Known allergies to penicillin (hives) and sulfa drugs (rash).</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="st">Vitals on admission: BP 142/88, HR 78, RR 16, Temp 98.6°F, SpO2 97</span><span class="sc">% o</span><span class="st">n room air.</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="st">Recent HbA1c was 7.2</span><span class="sc">% d</span><span class="st">own from 7.8%. Patient scheduled for routine colonoscopy next month. </span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="st">Patient celebrated his 62nd birthday on Tuesday, March 8th, 2025.</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="st">Medical record number: 87654321</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>clinical_note <span class="op">=</span><span class="st">" "</span>.join(clinical_note.splitlines())</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>xml_prompt <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="ss">You're a medical records analyst at a Clinical Electronics Health Records company. </span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="ss">Generate a comprehensive patient summary for our medical team.</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="ss">Our hospital uses structured data formats for efficient information transfer between departments. </span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="ss">The medical team needs clear, concise, and actionable patient information.</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="ss">Use this clinical note for your summary:</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;clinical_note&gt;</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span>clinical_note<span class="sc">}</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/clinical_note&gt;</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;instructions&gt;</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="ss">1. Extract patient information including: Patient Name, MRN,  DOB (ONLY calculate DOB if enough information is given)</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a><span class="ss">2. Extract and organize: Medications, Allergies, Vital Signs, and Recent Procedures</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a><span class="ss">3. Highlight critical values and potential drug interactions</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a><span class="ss">4. Format as a nested table structure for easy reference</span></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/instructions&gt;</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a><span class="ss">Please include all relevant information and maintain the nested table structure in your summary.</span></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a><span class="ss">Replace missing data with N/A.</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a><span class="ss">Make your tone clinical and precise. </span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a><span class="ss">Follow this structure exactly and only return the formatted output:</span></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;formatting_example&gt;</span></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a><span class="ss">**PATIENT SUMMARY**</span></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a><span class="ss">**Patient**: John Doe </span></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a><span class="ss">**MRN**: 12345678 </span></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a><span class="ss">**DOB**: 01/15/1965</span></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a><span class="ss">**Exam Date**: 06/12/2020</span></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a><span class="ss">**MEDICATIONS**</span></span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a><span class="ss">| Medication | Dosage | Frequency | Route | Indication |</span></span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a><span class="ss">|------------|--------|-----------|-------|------------|</span></span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a><span class="ss">| Lisinopril | 20mg   | Daily     | PO    | HTN        |</span></span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a><span class="ss">**ALLERGIES**</span></span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a><span class="ss">| Allergen   | Reaction  | Severity  |</span></span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a><span class="ss">|------------|-----------|-----------|</span></span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a><span class="ss">| Penicillin | Urticaria | Moderate  |</span></span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a><span class="ss">**VITAL SIGNS** (Date: 03/15/2025)</span></span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a><span class="ss">| Parameter       | Value      | Status    |</span></span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a><span class="ss">|-----------------|------------|-----------|</span></span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a><span class="ss">| BP              | 132/78     | WNL       |</span></span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a><span class="ss">| Heart Rate      | 88 bpm     | WNL       |</span></span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a><span class="ss">| Temperature     | 99.1°F     | ELEVATED  |</span></span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a><span class="ss">| Oxygen Sat      | 97%        | WNL       |</span></span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a><span class="ss">**LAB VALUES**</span></span>
<span id="cb27-61"><a href="#cb27-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-62"><a href="#cb27-62" aria-hidden="true" tabindex="-1"></a><span class="ss">| Test  | Value | Units | Date      |</span></span>
<span id="cb27-63"><a href="#cb27-63" aria-hidden="true" tabindex="-1"></a><span class="ss">|-------|-------|-------|-----------|</span></span>
<span id="cb27-64"><a href="#cb27-64" aria-hidden="true" tabindex="-1"></a><span class="ss">|Glucose| 70    | mg/dL | 12/12/2024|</span></span>
<span id="cb27-65"><a href="#cb27-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-66"><a href="#cb27-66" aria-hidden="true" tabindex="-1"></a><span class="ss">**RECENT &amp; SCHEDULED PROCEDURES**</span></span>
<span id="cb27-67"><a href="#cb27-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-68"><a href="#cb27-68" aria-hidden="true" tabindex="-1"></a><span class="ss">| Procedure     | Date       | Provider | Key Findings |</span></span>
<span id="cb27-69"><a href="#cb27-69" aria-hidden="true" tabindex="-1"></a><span class="ss">|---------------|------------|----------|--------------|</span></span>
<span id="cb27-70"><a href="#cb27-70" aria-hidden="true" tabindex="-1"></a><span class="ss">| Heart Surgery | Next month | Dr. Smith| N/A          |</span></span>
<span id="cb27-71"><a href="#cb27-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-72"><a href="#cb27-72" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/formatting_example&gt;</span></span>
<span id="cb27-73"><a href="#cb27-73" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-72" class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Pass the few-shot prompt to the model</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>model_id <span class="op">=</span> <span class="st">"anthropic.claude-3-haiku-20240307-v1:0"</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> invoke_model(model_id, xml_prompt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-87" class="cell" data-execution_count="165">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Display the user query and model response</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>display_chat_bubble(user_query, sender<span class="op">=</span><span class="st">"user"</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>display_chat_bubble(model_response, sender<span class="op">=</span><span class="st">"model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

    
    
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Chat Bubble</title>
    
    
        <div style="display: flex; align-items: flex-end; justify-content: flex-end;">
            <div style="
        background-color: #E2D3F8;
        color: #333;
        border-radius: 15px;
        padding: 5px 20px;
        margin: 5px 10px;
        align-self: flex-end;
        max-width: 70%;
        word-wrap: break-word;
        font-family: Arial, sans-serif;
        font-size: 11pt;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        white-space: pre-wrap;
        text-align: left;
        ">
                <span style="float: right;font-size: 15pt;"><img src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/1f464.svg" style="height: 1.2em; vertical-align: middle;" alt="👤"></span><b><span style="float: right;">User Query </span></b><br>
                <p>You're a medical records analyst at a Clinical Electronics Health Records company. 
Generate a comprehensive patient summary for our medical team.
Our hospital uses structured data formats for efficient information transfer between departments. 
The medical team needs clear, concise, and actionable patient information.
Use this clinical note for your summary:
<clinical_note>
 Todays date is March 12th, 2025. Patient, Marty K. Martin, is a 62-year-old male with a history of hypertension, type 2 diabetes, and hyperlipidemia.  Currently taking Lisinopril 20mg daily, Metformin 1000mg BID, and Atorvastatin 40mg at bedtime.  Patient reports having a coronary artery bypass graft (CABG) 5 years ago. Known allergies to penicillin (hives) and sulfa drugs (rash). Vitals on admission: BP 142/88, HR 78, RR 16, Temp 98.6°F, SpO2 97% on room air. Recent HbA1c was 7.2% down from 7.8%. Patient scheduled for routine colonoscopy next month.  Patient celebrated his 62nd birthday on Tuesday, March 8th, 2025. Medical record number: 87654321
</clinical_note>
<instructions>
1. Extract patient information including: Patient Name, MRN,  DOB (ONLY calculate DOB if enough information is given)
2. Extract and organize: Medications, Allergies, Vital Signs, and Recent Procedures
3. Highlight critical values and potential drug interactions
4. Format as a nested table structure for easy reference
</instructions>
Please include all relevant information and maintain the nested table structure in your summary.
Replace missing data with N/A.
Make your tone clinical and precise. 
Follow this structure exactly and only return the formatted output:
<formatting_example>
<strong>PATIENT SUMMARY</strong>
<strong>Patient</strong>: John Doe 
<strong>MRN</strong>: 12345678 
<strong>DOB</strong>: 01/15/1965
<strong>Exam Date</strong>: 06/12/2020
<strong>MEDICATIONS</strong></formatting_example></p>

<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Medication</th>
<th data-quarto-table-cell-role="th">Dosage</th>
<th data-quarto-table-cell-role="th">Frequency</th>
<th data-quarto-table-cell-role="th">Route</th>
<th data-quarto-table-cell-role="th">Indication</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Lisinopril</td>
<td>20mg</td>
<td>Daily</td>
<td>PO</td>
<td>HTN</td>
</tr>
</tbody>
</table>
<p><strong>ALLERGIES</strong></p>
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Allergen</th>
<th data-quarto-table-cell-role="th">Reaction</th>
<th data-quarto-table-cell-role="th">Severity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Penicillin</td>
<td>Urticaria</td>
<td>Moderate</td>
</tr>
</tbody>
</table>
<p><strong>VITAL SIGNS</strong> (Date: 03/15/2025)</p>
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Parameter</th>
<th data-quarto-table-cell-role="th">Value</th>
<th data-quarto-table-cell-role="th">Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BP</td>
<td>132/78</td>
<td>WNL</td>
</tr>
<tr class="even">
<td>Heart Rate</td>
<td>88 bpm</td>
<td>WNL</td>
</tr>
<tr class="odd">
<td>Temperature</td>
<td>99.1°F</td>
<td>ELEVATED</td>
</tr>
<tr class="even">
<td>Oxygen Sat</td>
<td>97%</td>
<td>WNL</td>
</tr>
</tbody>
</table>
<p><strong>LAB VALUES</strong></p>
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Test</th>
<th data-quarto-table-cell-role="th">Value</th>
<th data-quarto-table-cell-role="th">Units</th>
<th data-quarto-table-cell-role="th">Date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Glucose</td>
<td>70</td>
<td>mg/dL</td>
<td>12/12/2024</td>
</tr>
</tbody>
</table>
<p><strong>RECENT &amp; SCHEDULED PROCEDURES</strong></p>
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Procedure</th>
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">Provider</th>
<th data-quarto-table-cell-role="th">Key Findings</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Heart Surgery</td>
<td>Next month</td>
<td>Dr. Smith</td>
<td>N/A</td>
</tr>
</tbody>
</table>

<p></p>
            </div>
        </div>
    
    
</div>
<div class="cell-output cell-output-display">

    
    
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Chat Bubble</title>
    
    
        <div style="display: flex; align-items: flex-start; justify-content: flex-start;">
            <div style="
        background-color: #e1f8fe;
        color: #333;
        border-radius: 15px;
        padding: 5px 20px;
        margin: 5px 5px;
        align-self: flex-start;
        max-width: 70%;
        word-wrap: break-word;
        font-family: Arial, sans-serif;
        font-size: 11pt;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        white-space: pre-wrap;
        text-align: left;
        ">
                <span style="float: left;font-size: 15pt;"><img src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/svg/1fa7a.svg" style="height: 1.2em; vertical-align: middle;" alt="🩺"></span><b><span style="float: left;"> LLM Response</span></b><br>
                <p><formatting_example>
<strong>PATIENT SUMMARY</strong>
<strong>Patient</strong>: Marty K. Martin
<strong>MRN</strong>: 87654321
<strong>DOB</strong>: 03/08/1963
<strong>Exam Date</strong>: 03/12/2025</formatting_example></p>
<p><strong>MEDICATIONS</strong></p>

<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Medication</th>
<th data-quarto-table-cell-role="th">Dosage</th>
<th data-quarto-table-cell-role="th">Frequency</th>
<th data-quarto-table-cell-role="th">Route</th>
<th data-quarto-table-cell-role="th">Indication</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Lisinopril</td>
<td>20mg</td>
<td>Daily</td>
<td>PO</td>
<td>Hypertension</td>
</tr>
<tr class="even">
<td>Metformin</td>
<td>1000mg</td>
<td>BID</td>
<td>PO</td>
<td>Diabetes</td>
</tr>
<tr class="odd">
<td>Atorvastatin</td>
<td>40mg</td>
<td>Bedtime</td>
<td>PO</td>
<td>Hyperlipidemia</td>
</tr>
</tbody>
</table>
<p><strong>ALLERGIES</strong></p>
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Allergen</th>
<th data-quarto-table-cell-role="th">Reaction</th>
<th data-quarto-table-cell-role="th">Severity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Penicillin</td>
<td>Hives</td>
<td>Moderate</td>
</tr>
<tr class="even">
<td>Sulfa Drugs</td>
<td>Rash</td>
<td>Moderate</td>
</tr>
</tbody>
</table>
<p><strong>VITAL SIGNS</strong> (Date: 03/12/2025)</p>
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Parameter</th>
<th data-quarto-table-cell-role="th">Value</th>
<th data-quarto-table-cell-role="th">Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Blood Pressure</td>
<td>142/88</td>
<td>ELEVATED</td>
</tr>
<tr class="even">
<td>Heart Rate</td>
<td>78 bpm</td>
<td>WNL</td>
</tr>
<tr class="odd">
<td>Temperature</td>
<td>98.6°F</td>
<td>WNL</td>
</tr>
<tr class="even">
<td>Oxygen Saturation</td>
<td>97%</td>
<td>WNL</td>
</tr>
<tr class="odd">
<td>Respiratory Rate</td>
<td>16 bpm</td>
<td>WNL</td>
</tr>
</tbody>
</table>
<p><strong>LAB VALUES</strong></p>
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Test</th>
<th data-quarto-table-cell-role="th">Value</th>
<th data-quarto-table-cell-role="th">Units</th>
<th data-quarto-table-cell-role="th">Date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>HbA1c</td>
<td>7.2</td>
<td>%</td>
<td>03/12/2025</td>
</tr>
</tbody>
</table>
<p><strong>RECENT &amp; SCHEDULED PROCEDURES</strong></p>
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Procedure</th>
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">Provider</th>
<th data-quarto-table-cell-role="th">Key Findings</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Coronary Artery Bypass Graft (CABG)</td>
<td>5 years ago</td>
<td>N/A</td>
<td>N/A</td>
</tr>
<tr class="even">
<td>Colonoscopy</td>
<td>Next month</td>
<td>N/A</td>
<td>N/A</td>
</tr>
</tbody>
</table>

<p></p>
            </div>
        </div>
    
    
</div>
</div>
</section>
<section id="what-do-we-see-3" class="level3">
<h3 class="anchored" data-anchor-id="what-do-we-see-3">What do we see?</h3>
<p>We see that the model was able to successfully extract all the relevant information from the provided text. This was after several rounds of refining the input prompt. After extracting the relevant information, the model followed the formatting example and correctly formatted the output data.</p>
<p>There are a few interesting things to note in the model’s output:</p>
<ul>
<li>Although the term <code>MRN</code> does not explicitly appear in the text, the model identified that <code>MRN</code> stood for <code>Medical Record Number</code> and pulled out the listed number.</li>
<li>The patient’s <code>DOB</code> was not explicitly mentioned but context clues were given to figure out the patient’s <code>DOB</code> like:
<ul>
<li><code>Patient, Marty K. Martin, is a 62-year-old</code></li>
<li><code>Patient celebrated his 62nd birthday on Tuesday, March 8th, 2025</code></li>
</ul></li>
<li>The model was able to correctly match each of the medications to their indications:
<ul>
<li><code>Lisinopril</code> –&gt; <code>Hypertension</code></li>
<li><code>Metformin</code> –&gt; <code>Diabetes</code></li>
<li><code>Atorvastatin</code> –&gt; <code>Hyperlipidemia</code></li>
</ul></li>
<li>Within the vital signs table, the model correctly identified that the <code>blood pressure</code> reported was <code>ELEVATED</code> (typical 120/80)<br>
</li>
<li>The patient’s <code>HBA1C</code> was correctly extracted and the units were correctly identified</li>
<li>Both the past and upcoming <code>procedures</code> for the patient were correctly identified and extracted with an informative date assigned.</li>
</ul>
</section>
</section>
</section>
<section id="putting-it-all-together" class="level1">
<h1>Putting it all together</h1>
<p>Now that we have all the components that we need we can encapsulate it into a helpful UI (User Interface) and deploy it to a cloud provider like AWS EC2, GCP, Azure, or Hugging Face (HF).</p>
<p>Since Hugging Face is quick and easy to set up, we can create and use a Hugging Face Space to host our app. HF also hosts a number of open-source LLMs so we can switch between Bedrock models and HF in our app. We’ll need:</p>
<ul>
<li>UI code like Streamlit with connections to make API calls to the models (like we did above using <code>boto</code>). The model outputs are passed to Streamlit to present it in a nicer format.</li>
<li>From there we can put our Streamlit file into our Hugging Face Space.</li>
<li>Then run our app, which will create an interface to interact with our models.</li>
</ul>
<p>For example, this is a simple Streamlit app using AWS Bedrock saved as <code>app.py</code>:</p>
<details>
<summary>
Code
</summary>
<ul>
<li><p><strong>Import libraries </strong></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|||||||||||||||||||||||||||||||||||||||||||||||||</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co">#                  IMPORTS</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> streamlit <span class="im">as</span> st</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> boto3</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv, dotenv_values</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong>Set up prompt</strong></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|||||||||||||||||||||||||||||||||||||||||||||||||</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co">#                   PROMPT</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co">#==================================================</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co">#       Setting up Prompt</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co">#%% Clinical Narative Summarization</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the examples and query</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>cns_example_1 <span class="op">=</span> <span class="st">"""</span><span class="ch">\</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="st">**INPUT:**</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="st">MRI of the right knee demonstrates a complex tear of the posterior horn and body of the medial meniscus. </span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="st">There is moderate joint effusion and mild chondromalacia of the patellofemoral compartment. </span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="st">The anterior and posterior cruciate ligaments are intact.</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="ch">\n</span><span class="st">**OUTPUT:**</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="ch">\n</span><span class="st">**Key Findings:** Complex tear of medial meniscus (posterior horn and body); Moderate joint effusion; Mild patellofemoral chondromalacia</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="ch">\n</span><span class="st">**Recommendations:** Orthopedic consultation; Consider arthroscopic evaluation and treatment</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>cns_example_2 <span class="op">=</span> <span class="st">"""</span><span class="ch">\</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="st">**INPUT:**</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="st">Chest X-ray shows clear lung fields bilaterally with no evidence of consolidation, effusion, or pneumothorax. </span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="st">The heart size is within normal limits. </span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="st">No acute cardiopulmonary process identified.</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a><span class="ch">\n</span><span class="st">**OUTPUT:**</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a><span class="ch">\n</span><span class="st">**Key Findings:** Clear lung fields; Normal heart size; No acute cardiopulmonary process</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a><span class="ch">\n</span><span class="st">**Recommendations:** No further imaging needed at this time</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>cns_query <span class="op">=</span> <span class="st">"""</span><span class="ch">\</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a><span class="st">Patient presents with a 3-day history of high fever (103°F), chills, productive cough with yellow sputum, and pleuritic chest pain exacerbated by deep breathing. </span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a><span class="st">Physical exam reveals decreased breath sounds and crackles in the right lower lung field. </span></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a><span class="st">ECG shows sinus tachycardia, but is otherwise unremarkable. </span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a><span class="st">Chest X-ray demonstrates consolidation in the right lower lobe, and a small right-sided pleural effusion. White blood cell count is elevated.</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>cns_query <span class="op">=</span><span class="st">" "</span>.join(cns_query.splitlines())</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the examples and query into a single prompt</span></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a><span class="co"># We'll use f-strings to insert the content from the examples and query into the full prompt.</span></span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>cns_prompt <span class="op">=</span> <span class="ss">f"""</span><span class="ch">\</span></span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a><span class="ss">**Task:** Summarize the following medical report into key findings and recommendations.</span></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a><span class="ss">Follow  the format of the examples strictly. Make the summary concise and actionable.</span></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a><span class="ss">The the key findings should be short and to the point.</span></span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a><span class="ss">The key findings should be less than 5 words.</span></span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a><span class="ss">The recommendations should be clear and specific.</span></span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a><span class="ss">The summary should be in the following format:</span></span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a><span class="ch">\n</span><span class="ss">**Key Findings:** [colon-separated list of key findings]</span></span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a><span class="ch">\n</span><span class="ss">**Recommendations:** [colon-separated list of recommendations]</span></span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span>cns_example_1<span class="sc">}</span></span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span>cns_example_2<span class="sc">}</span></span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a><span class="ss">Now summarize this medical report:</span></span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a><span class="ss">**INPUT:**</span></span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a><span class="co">#..................................................</span></span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a><span class="co">#==================================================</span></span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Task Prompts</span></span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a>tasks <span class="op">=</span> {</span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Clinical Narrative Summarization"</span>: {</span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a>        <span class="st">"prompt"</span>: cns_prompt,</span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a>        <span class="st">"example_query"</span>: cns_query,</span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a>    },}</span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_prompts(task_name, query):</span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> task_name <span class="op">==</span> <span class="st">"Clinical Narrative Summarization"</span>:</span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a>        prompt <span class="op">=</span> <span class="ss">f"""</span><span class="ch">\</span></span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a><span class="ss">**Task:** Summarize the following medical report into key findings and recommendations.</span></span>
<span id="cb31-67"><a href="#cb31-67" aria-hidden="true" tabindex="-1"></a><span class="ss">Follow  the format of the examples strictly. Make the summary concise and actionable.</span></span>
<span id="cb31-68"><a href="#cb31-68" aria-hidden="true" tabindex="-1"></a><span class="ss">The key findings should be short and to the point.</span></span>
<span id="cb31-69"><a href="#cb31-69" aria-hidden="true" tabindex="-1"></a><span class="ss">The key findings should be less than 5 words.</span></span>
<span id="cb31-70"><a href="#cb31-70" aria-hidden="true" tabindex="-1"></a><span class="ss">The recommendations should be clear and specific.</span></span>
<span id="cb31-71"><a href="#cb31-71" aria-hidden="true" tabindex="-1"></a><span class="ss">The summary should be in the following format:</span></span>
<span id="cb31-72"><a href="#cb31-72" aria-hidden="true" tabindex="-1"></a><span class="ch">\n</span><span class="ss">**Key Findings:** [colon-separated list of key findings]</span></span>
<span id="cb31-73"><a href="#cb31-73" aria-hidden="true" tabindex="-1"></a><span class="ch">\n</span><span class="ss">**Recommendations:** [colon-separated list of recommendations]</span></span>
<span id="cb31-74"><a href="#cb31-74" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span>cns_example_1<span class="sc">}</span></span>
<span id="cb31-75"><a href="#cb31-75" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span>cns_example_2<span class="sc">}</span></span>
<span id="cb31-76"><a href="#cb31-76" aria-hidden="true" tabindex="-1"></a><span class="ss">Now summarize this medical report:</span></span>
<span id="cb31-77"><a href="#cb31-77" aria-hidden="true" tabindex="-1"></a><span class="ss">**INPUT:**</span></span>
<span id="cb31-78"><a href="#cb31-78" aria-hidden="true" tabindex="-1"></a><span class="sc">{</span>query<span class="sc">}</span></span>
<span id="cb31-79"><a href="#cb31-79" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb31-80"><a href="#cb31-80" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> prompt, query</span>
<span id="cb31-81"><a href="#cb31-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-82"><a href="#cb31-82" aria-hidden="true" tabindex="-1"></a><span class="co">#_____________________________________________________</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong>Set up AWS Bedrock</strong></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|||||||||||||||||||||||||||||||||||||||||||||||||</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co">#                   AWS Bedrock</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">#==================================================</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co">#       Define AWS Helper function</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> invoke_model(model_id, user_message, conversation<span class="op">=</span><span class="va">None</span>, inference_config<span class="op">=</span><span class="va">None</span>, verbose<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # Set the model ID, e.g., Claude 3 Haiku.</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># model_id = "anthropic.claude-3-haiku-20240307-v1:0"</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # Start a conversation with the user message.</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># user_message = "Describe the python language."</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> conversation <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>        conversation <span class="op">=</span> [</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>            {</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>                <span class="st">"role"</span>: <span class="st">"user"</span>,</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>                <span class="st">"content"</span>: [{<span class="st">"text"</span>: user_message}],</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set the inference configuration.</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> inference_config <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>        inference_config <span class="op">=</span> {</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">"maxTokens"</span>: <span class="dv">512</span>,</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>            <span class="st">"temperature"</span>: <span class="fl">0.5</span>,</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">"topP"</span>: <span class="fl">0.9</span>,</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Send the message to the model, using a basic inference configuration.</span></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span>  client.converse(</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>            modelId<span class="op">=</span>model_id,</span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>            messages<span class="op">=</span>conversation,</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>            inferenceConfig<span class="op">=</span>inference_config</span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract and print the response text.</span></span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>        response_text <span class="op">=</span> response[<span class="st">"output"</span>][<span class="st">"message"</span>][<span class="st">"content"</span>][<span class="dv">0</span>][<span class="st">"text"</span>]</span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> verbose:</span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Request: </span><span class="sc">{</span>user_message<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Response: </span><span class="sc">{</span>response_text<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> response_text</span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> (<span class="pp">Exception</span>) <span class="im">as</span> e:</span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"ERROR: Can't invoke '</span><span class="sc">{</span>model_id<span class="sc">}</span><span class="ss">'. Reason: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>        exit(<span class="dv">1</span>)</span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a><span class="co">#..................................................</span></span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a><span class="co">#==================================================</span></span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure AWS credentials</span></span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> boto3.client(</span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true" tabindex="-1"></a>    service_name<span class="op">=</span><span class="st">'bedrock-runtime'</span>,</span>
<span id="cb32-56"><a href="#cb32-56" aria-hidden="true" tabindex="-1"></a>    region_name<span class="op">=</span>os.environ[<span class="st">'AWS_DEFAULT_REGION'</span>], <span class="co">#Region where the Bedrock service is running e.g. us-east-1</span></span>
<span id="cb32-57"><a href="#cb32-57" aria-hidden="true" tabindex="-1"></a>    aws_access_key_id<span class="op">=</span>os.environ[<span class="st">'AWS_ACCESS_KEY_ID'</span>], <span class="co">#AWS Access Key ID</span></span>
<span id="cb32-58"><a href="#cb32-58" aria-hidden="true" tabindex="-1"></a>    aws_secret_access_key<span class="op">=</span>os.environ[<span class="st">'AWS_SECRET_ACCESS_KEY'</span>] <span class="co">#AWS Secret Access Key</span></span>
<span id="cb32-59"><a href="#cb32-59" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-60"><a href="#cb32-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-61"><a href="#cb32-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-62"><a href="#cb32-62" aria-hidden="true" tabindex="-1"></a>model_links <span class="op">=</span>{ <span class="st">"Claude-3-Haiku"</span>:<span class="st">"anthropic.claude-3-haiku-20240307-v1:0"</span>}</span>
<span id="cb32-63"><a href="#cb32-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the available models</span></span>
<span id="cb32-64"><a href="#cb32-64" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span>[key <span class="cf">for</span> key <span class="kw">in</span> model_links.keys()]</span>
<span id="cb32-65"><a href="#cb32-65" aria-hidden="true" tabindex="-1"></a>model_url <span class="op">=</span> model_links[model_name]</span>
<span id="cb32-66"><a href="#cb32-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-67"><a href="#cb32-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-68"><a href="#cb32-68" aria-hidden="true" tabindex="-1"></a><span class="co">#_____________________________________________________</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong>Set up Streamlit</strong></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|||||||||||||||||||||||||||||||||||||||||||||||||</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co">#                   Streamlit</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Streamlit App</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>st.title(<span class="st">"LLM Clinical Data Analysis"</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>model_name <span class="op">=</span> st.sidebar.selectbox(<span class="st">"Select Model"</span>, models)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>task_name <span class="op">=</span> st.selectbox(<span class="st">"Select Task"</span>, <span class="bu">list</span>(tasks.keys()))</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> st.text_area(<span class="st">"Enter Query"</span>, value<span class="op">=</span>tasks[task_name][<span class="st">"example_query"</span>])</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>model_url <span class="op">=</span> model_links[model_name]</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> st.expander(<span class="st">"Updated Prompt"</span>):</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    input_text, query <span class="op">=</span> generate_prompts(task_name, query)</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    st.write(<span class="bu">str</span>(input_text))</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> st.button(<span class="st">"Analyze"</span>):    </span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> invoke_model(model_url, input_text)</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>    st.write(<span class="st">"Analysis Result:"</span>, result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</details>
<p>You can experiment with the live app <a href="https://ngebodh.github.io/projects/Short_dive_posts/aws-demo/aws-analysis-demo.html">here</a>.</p>
<p><em>Extra:</em> See how to create an LLM Streamlit UI <a href="https://ngebodh.github.io/projects/2024-03-05/">here</a> <span class="citation" data-cites="gebodh2024BuildingLLMchatbot">(<a href="#ref-gebodh2024BuildingLLMchatbot" role="doc-biblioref">Gebodh, 2024a</a>)</span>.</p>
<figure class="figure">
<img src="LLM-med.gif" alt="LLM word generation" width="100%" height="auto" style="display: block; margin-left: auto; margin-right: auto; border: none;" class="figure-img">
<figcaption style="margin-top: 5px; font-style: italic; color: #555;">
LLM clinical data analysis app switching from AWS Bedrock to HF hosted models and using Google’s Gemma 3 - 27B.
</figcaption>
</figure>
</section>
<section id="take-away" class="level1">
<h1>Take Away</h1>
<p>We showcased the power of <strong>LLMs</strong> for <strong>clinical data analysis</strong> using <strong>AWS Bedrock</strong>, demonstrating efficient <strong>data extraction</strong>, <strong>summarization</strong>, and <strong>interpretation</strong>.</p>
<p>We explored:</p>
<ul>
<li>Clinical narrative summarization</li>
<li>Diagnosis generation</li>
<li>Medical data classification</li>
<li>Structured data extraction</li>
</ul>
<p>These examples highlighted how effective prompt engineering enables LLMs to perform complex medical tasks. However, these outputs are meant to:</p>
<ul>
<li>Assist, not replace, medical professionals.</li>
<li>Be validated by clinical experts, adhering to all relevant regulations (HIPAA, GDPR, etc.).</li>
</ul>
<p>When properly guided, LLMs can streamline workflows and improve data management, potentially leading to better patient outcomes.</p>
<hr>
<section id="cite-as" class="level6">
<h6 class="anchored" data-anchor-id="cite-as"><strong>Cite as</strong></h6>


<pre><code>
@misc{Gebodh2025BuildingLLMClinicalDataAnalyticsPipelineswithAWSBedrock,
  title = {Building LLM Clinical Data Analytics Pipelines with AWS Bedrock},
  author = {Nigel Gebodh},
  year = {2025},
  url = {https://ngebodh.github.io/projects/Short_dive_posts/aws/aws-analysis.html},
  note = {Published: April 11, 2025}
}
</code></pre>

</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-brown2020languagemodelsfewshotlearners" class="csl-entry" role="listitem">
Brown, T. B., Mann, B., Ryder, N., Subbiah, M., Kaplan, J., Dhariwal, P., Neelakantan, A., Shyam, P., Sastry, G., Askell, A., Agarwal, S., Herbert-Voss, A., Krueger, G., Henighan, T., Child, R., Ramesh, A., Ziegler, D. M., Wu, J., Winter, C., … Amodei, D. (2020). <em>Language models are few-shot learners</em>. <a href="https://arxiv.org/abs/2005.14165">https://arxiv.org/abs/2005.14165</a>
</div>
<div id="ref-gebodh2024BuildingLLMchatbot" class="csl-entry" role="listitem">
Gebodh, N. (2024a). <em>Large language models - chatting with AI chatbots from google, mistral AI, and hugging face</em>. <a href="https://ngebodh.github.io/projects/2024-03-05/">https://ngebodh.github.io/projects/2024-03-05/</a>
</div>
<div id="ref-gebodh2024LLMtemperature" class="csl-entry" role="listitem">
Gebodh, N. (2024b). <em>Why does my LLM have a temperature?</em> <a href="https://ngebodh.github.io/projects/Short_dive_posts/LLM_temp/LLM_temp.html">https://ngebodh.github.io/projects/Short_dive_posts/LLM_temp/LLM_temp.html</a>
</div>
<div id="ref-qiao2023reasoninglanguagemodelprompting" class="csl-entry" role="listitem">
Qiao, S., Ou, Y., Zhang, N., Chen, X., Yao, Y., Deng, S., Tan, C., Huang, F., &amp; Chen, H. (2023). <em>Reasoning with language model prompting: A survey</em>. <a href="https://arxiv.org/abs/2212.09597">https://arxiv.org/abs/2212.09597</a>
</div>
<div id="ref-schulhoff2025promptreportsystematicsurvey" class="csl-entry" role="listitem">
Schulhoff, S., Ilie, M., Balepur, N., Kahadze, K., Liu, A., Si, C., Li, Y., Gupta, A., Han, H., Schulhoff, S., Dulepet, P. S., Vidyadhara, S., Ki, D., Agrawal, S., Pham, C., Kroiz, G., Li, F., Tao, H., Srivastava, A., … Resnik, P. (2025). <em>The prompt report: A systematic survey of prompt engineering techniques</em>. <a href="https://arxiv.org/abs/2406.06608">https://arxiv.org/abs/2406.06608</a>
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Nigel Gebodh, Made on Earth by a Human</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>